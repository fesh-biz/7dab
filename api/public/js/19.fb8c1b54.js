(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{bf17:function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-card",{staticClass:"q-my-md",attrs:{flat:t.$q.platform.is.mobile}},[o("q-card-section",[o("post-status-explanation",{attrs:{"post-id":t.postId}})],1),t.post&&!t.post.deleted?[o("q-separator",{attrs:{spaced:"md"}}),o("q-card-section",[o("q-input",{attrs:{outlined:"",dense:"",label:t.$t("title"),error:!!t.postEditor.validator.errors.title,"error-message":t.postEditor.validator.errors.title},on:{input:function(e){return t.postEditor.validator.resetFieldError("title")}},model:{value:t.postEditor.formModel.title,callback:function(e){t.$set(t.postEditor.formModel,"title",e)},expression:"postEditor.formModel.title"}}),o("div",{staticClass:"ap-body"},t._l(t.postEditor.formModel.sections,(function(e,i){return o("div",{key:"body-element"+e.order,staticClass:"q-mb-md"},[o("div",[o("icon-with-tooltip",{attrs:{tooltip:t.$t("delete_section"),icon:"delete"},on:{click:function(e){return t.postEditor.deleteSection(i)}}})],1),"youtube"===e.type?o("you-tube-field",{model:{value:e.content,callback:function(o){t.$set(e,"content",o)},expression:"section.content"}}):t._e(),"youtube"!==e.type?o(e.type+"-field",{ref:"editor["+e.order+"]",refInFor:!0,tag:"component",attrs:{content:e.content,order:e.order,"error-message":t.getSectionError(e.order)},on:{input:function(o){return t.postEditor.validator.resetFieldError("sections",e.order)}}}):t._e()],1)})),0),o("tag-field",{attrs:{"error-message":t.tagError},on:{input:t.updatePostTags}})],1),t.postEditor.validator.mainErrorMessage?o("q-card-section",{staticClass:"flex justify-center"},[o("div",{staticClass:"q-pa-md",staticStyle:{color:"white","background-color":"red","border-radius":"5px"}},[t._v("\n        "+t._s(t.postEditor.validator.mainErrorMessage)+"\n      ")])]):t._e(),t.postEditor.totalImages?o("q-card-section",{staticClass:"flex justify-center"},[o("div",{class:{"main-error-message":t.postEditor.totalImages>t.postEditor.totalImagesMax}},[t._v("\n        "+t._s(t.$t("total_number_of_images"))+":\n        "+t._s(t.postEditor.totalImages)+"\n        ("+t._s(t.$t("maximum"))+": "+t._s(t.postEditor.totalImagesMax)+")\n      ")])]):t._e(),o("q-card-section",{staticClass:"flex justify-between"},[o("q-inner-loading",{attrs:{showing:t.isBusy,color:"positive"}}),o("div",{staticClass:"inline-block"},[o("icon-with-tooltip",{attrs:{tooltip:t.$t("add_text"),color:"positive",disabled:t.isBusy,size:"xl",icon:"notes"},on:{click:function(e){return t.postEditor.addSection("text")}}}),o("icon-with-tooltip",{attrs:{tooltip:t.$t("add_image"),color:"positive",disabled:t.isBusy,size:"xl",icon:"image"},on:{click:function(e){return t.postEditor.addSection("image")}}}),o("icon-with-tooltip",{attrs:{tooltip:t.$t("add_youtube"),color:"positive",disabled:t.isBusy,size:"xl",icon:"smart_display"},on:{click:function(e){return t.postEditor.addSection("youtube")}}})],1),o("div",{staticClass:"inline-block"},[t.canBeViewed?o("icon-with-tooltip",{attrs:{tooltip:t.$t("preview"),color:"positive",disabled:t.isBusy,size:"xl",icon:"pageview"},on:{click:function(e){return t.$router.push({name:"postPage",params:{id:t.postId},query:{p:1}})}}}):t._e(),o("icon-with-tooltip",{attrs:{tooltip:t.$t("cancel"),color:"negative",disabled:t.isBusy,size:"xl",icon:"cancel"},on:{click:t.goBack}}),o("icon-with-tooltip",{attrs:{tooltip:t.$t("save"),color:"positive",disabled:t.isBusy,size:"xl",icon:"check_circle"},on:{click:function(e){return t.saveOrUpdate()}}})],1)],1)]:t._e()],2)},s=[],a=(o("e6cf"),o("ddb0"),o("5440")),r=o("e118"),n=o("a010"),l=o("a31e"),c=o("51d9"),d=o("4f9d"),p=o("5e86"),u=o("7cbd"),m=o("ee7a"),h=o("f67e"),f=o("5899c"),v=o("dc64"),g=o("9fac"),b=function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.post?o("div",[t.post.deleted?o("div",[o("p",[t._v("Теревеньку видалено. Що робимо?")]),o("div",[o("q-btn",{attrs:{to:{name:"home"},color:"positive","no-caps":"",flat:"",label:"На головну"}}),o("q-btn",{attrs:{to:{name:"createPost"},color:"positive","no-caps":"",flat:"",label:"Створити нову"}})],1)]):t._e(),t.post.deleted?t._e():[o("p",[t._v("\n      Теревенька має статус: "),o("strong",[t._v(t._s(t.$t(t.post.status)))])]),t.post.isDraft?o("div",[o("p",[t._v("\n        Ви можете продовжити редагування.\n      ")]),t._m(0),o("q-btn",{attrs:{dense:"",loading:t.isPublishing,disable:t.isPublishing,"no-caps":"",color:"positive",label:"Опублікувати"},on:{click:function(e){t.showConfirmPublication=!0}}}),o("confirm",{attrs:{title:"Підтвердити публікацію",message:"Не забудьте зберегти останні зміни перед цією дією. Після цієї дії ви не зможете редагувати або\n      видалити цю теревеньку.","on-confirm":t.onPublish},model:{value:t.showConfirmPublication,callback:function(e){t.showConfirmPublication=e},expression:"showConfirmPublication"}}),o("q-btn",{staticClass:"q-ml-md",attrs:{dense:"","no-caps":"",loading:t.isDeleting,disable:t.isDeleting,color:"negative",label:"Видалити"},on:{click:function(e){t.showConfirmDelete=!0}}}),o("confirm",{attrs:{title:"Підтвердити видалення",message:"Ви впевнені? Цю дію неможливо буде відмінити.","on-confirm":t.onDelete},model:{value:t.showConfirmDelete,callback:function(e){t.showConfirmDelete=e},expression:"showConfirmDelete"}})],1):t._e(),t.post.isDraft?t._e():o("div",[t.post.isApproved?o("p",[t._v("\n        Вітаємо, ваша теревенька опублікована!\n      ")]):t._e(),t.post.isDeclined?o("p",[t._v("\n        На жаль, ми відхилили запит на публікацію цієї теревеньки.\n      ")]):t._e(),t.post.isEditing?o("p",[t._v("\n        Ми редагуємо вашу теревеньку. Зміст не буде змінено, лише виправлені помилки.\n      ")]):t._e(),t._m(1)])]],2):t._e()},_=[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("p",[t._v("\n        Щоб відправити теревеньку на перевірку, натисніть на "),o("strong",[t._v("Опублікувати")]),t._v(". "),o("br"),o("strong",[t._v("Увага:")]),o("br"),t._v("\n        1. Ця дія не зберігає останні зроблені зміни. Щоб зробити це, натисніть зелену галочку знизу. "),o("br"),t._v("\n        2. Після цієї дії ви не зможете редагувати або видалити цю теревеньку.\n      ")])},function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("p",[o("strong",[t._v("Редагування не діє. Зміни не будуть збережені.")])])}],y=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-dialog",{attrs:{persistent:""},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[o("q-card",[o("q-card-section",{staticClass:"text-center"},[o("div",{staticClass:"text-h5"},[t._v(t._s(t.title))]),o("div",{staticClass:"text-subtitle1 q-mt-md"},[t._v(t._s(t.message))])]),o("q-card-actions",{attrs:{align:"center"}},[o("q-btn",{attrs:{label:"Ні",color:"negative"},on:{click:function(e){t.dialog=!1}}}),o("q-btn",{attrs:{label:"Так",color:"positive"},on:{click:t.confirm}})],1)],1)],1)},w=[],E={props:{title:{type:String,required:!0},message:{type:String,required:!0},onConfirm:{type:Function,required:!0},value:{type:Boolean,required:!0}},data(){return{}},computed:{dialog:{get(){return this.value},set(t){this.$emit("input",t)}}},methods:{confirm(){this.onConfirm(),this.dialog=!1}}},q=E,C=o("2877"),x=o("24e8"),k=o("f09f"),$=o("a370"),I=o("4b7e"),P=o("9c40"),B=o("eebe"),D=o.n(B),S=Object(C["a"])(q,y,w,!1,null,null,null),F=S.exports;D()(S,"components",{QDialog:x["a"],QCard:k["a"],QCardSection:$["a"],QCardActions:I["a"],QBtn:P["a"]});var M={name:"PostStatusExplanation",components:{Confirm:F},props:{postId:{type:[String,Number],required:!0}},data(){return{showConfirmPublication:!1,showConfirmDelete:!1,api:new u["a"],isPublishing:!1,isDeleting:!1,isDeleted:!1}},computed:{post(){return p["a"].query().find(this.postId)}},methods:{async onPublish(){try{this.isPublishing=!0,await this.api.publish(this.postId),this.isPublishing=!1,await p["a"].update({where:this.postId,data:{status:"pending"}}),this.$q.notify({position:"center",color:"positive",message:this.$t("success")})}catch(t){this.isPublishing=!1}},async onDelete(){try{this.isDeleting=!0,await this.api.delete(this.postId),await p["a"].update({where:this.postId,data:{deleted:!0}}),this.isDeleting=!1}catch(t){this.isDeleting=!1}}}},Q=M,T=Object(C["a"])(Q,b,_,!1,null,null,null),A=T.exports;D()(T,"components",{QBtn:P["a"]});var O={name:"AddPost",components:{TooltipIcon:l["a"],ImageField:a["a"],TextField:r["a"],IconWithTooltip:c["a"],TagField:n["a"],YouTubeField:f["a"],PostStatusExplanation:A},data(){return{postEditor:new d["a"],postApi:new u["a"],isBusy:!1,canBeViewed:!1}},computed:{sectionsErrors(){return this.postEditor.validator.errors.sections},isEditing(){return"editPost"===this.$route.name},postId(){return this.$route.params.id},post(){return p["a"].query().withAll().find(this.postId)},tagError(){return this.postEditor.validator.errors.tags||null}},async created(){if(!this.post){const t=await this.fetchPost();await p["a"].insert({data:t.data.data})}this.$nextTick((()=>{this.canBeViewed=!0,this.postEditor.fillFormModel(this.postId)}))},beforeDestroy(){this.postEditor.resetFormModel(),this.postEditor.validator.resetErrors()},methods:{goBack(){window.history.back()},fetchPost(){return new Promise(((t,e)=>{this.isBusy=!0,this.postApi.fetchPost(this.postId,!0).then((e=>{this.isBusy=!1,t(e)})).catch((()=>{this.isBusy=!1}))}))},getSectionError(t){const e=this.postEditor.validator.errors.sections;return e&&"string"!==typeof e?e[t]:null},async removeCache(t){const e=p["a"].query().withAll().find(t);if(e.post_images){const t=e.post_images.map((t=>t.id));for(const e of t)await m["a"].delete(e)}if(e.post_texts){const t=e.post_texts.map((t=>t.id));for(const e of t)await h["a"].delete(e)}if(e.post_you_tubes){const t=e.post_you_tubes.map((t=>t.id));for(const e of t)await v["a"].delete(e)}await g["a"].delete((e=>e.post_id===parseInt(t)))},async saveOrUpdate(){this.isBusy=!0,await this.removeCache(this.postId),this.postEditor.saveOrUpdate(this.postId).then((async t=>{this.isBusy=!1;const e=t.data,o=e.id;await p["a"].insertOrUpdate({where:o,data:e}),this.postEditor.fillFormModel(o),this.$q.notify({message:this.$t("success"),position:"center",color:"positive"})})).catch((t=>{this.isBusy=!1}))},updatePostTags(){this.postEditor.validator.resetFieldError("tags")},crtlSHandler(t){document.addEventListener("keydown",(t=>{t.ctrlKey&&"s"===t.key&&(t.preventDefault(),console.log("CTRL + S"))}))}}},j=O,z=o("eb85"),U=o("27f9"),L=o("74f7"),V=Object(C["a"])(j,i,s,!1,null,null,null);e["default"]=V.exports;D()(V,"components",{QCard:k["a"],QCardSection:$["a"],QSeparator:z["a"],QInput:U["a"],QInnerLoading:L["a"]})}}]);