(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{"0d8b":function(s,t,e){"use strict";e.r(t);var i=function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",[s.isFetchingPosts?e("q-linear-progress",{class:{"q-mt-md":!s.$q.platform.is.mobile},attrs:{indeterminate:""}}):s._e(),s._l(s.posts,(function(s,t){return e("post",{key:"post"+t,attrs:{post:s}})})),s.isLast?e("q-banner",{staticClass:"text-center",attrs:{dusk:"main-no-more-posts",rounded:""}},[s._v("\n    "+s._s(s.$t("there_is_no_new_posts"))+"\n  ")]):s._e(),s.isFetchingPosts&&s.posts.length?e("q-linear-progress",{staticClass:"q-mb-xl",attrs:{dusk:"main-new-posts-loading",indeterminate:""}}):s._e()],2)},o=[],a=(e("e6cf"),e("5e86")),n=e("f9a5"),c=e("7cbd"),r=e("09ad"),h=e("26d8"),l={name:"FeedMain",components:{Post:n["a"]},data(){return{isFetchingPosts:!0,cache:new h["a"],postApi:new c["a"],scroll:new r["a"],isPrevRequestSuccess:!0,posts:[],isLast:!1}},async created(){this.cache.hasCacheForCurrentPage("posts")?(this.posts=this.getPosts(),this.isFetchingPosts=!1):await this.fetchPosts()},mounted(){window.addEventListener("scroll",this.maybeFetchNextPosts)},methods:{scrollToPost(s){const t=document.getElementById(s);t?setTimeout((()=>{t.scrollIntoView({behavior:"smooth"})}),100):setTimeout((()=>{this.scrollToPost(s)}),100)},async maybeFetchNextPosts(){const s=await this.cache.getPagination("posts");this.isLast=s.is_last,this.isFetchingPosts||!this.scroll.isScrollBottom(500)||this.isLast||await this.fetchPosts()},getPosts(){const s=this.cache.getCurrentPageCacheIds("posts");return a["a"].query().withAll().whereIdIn(s).orderBy("id","desc").all()},async fetchPosts(){if(!this.isPrevRequestSuccess)return;this.isFetchingPosts=!0,this.isPrevRequestSuccess=!1;const s=await this.cache.getPagination("posts");this.postApi.fetchPosts(s.page).then((async s=>{await a["a"].insert({data:s.data.data}),this.posts=this.getPosts();const t=await this.cache.getPagination("posts");this.isLast=t.is_last,this.isFetchingPosts=!1,this.isPrevRequestSuccess=!0})).catch((()=>{this.isFetchingPosts=!1}))}},beforeDestroy(){window.removeEventListener("scroll",this.maybeFetchNextPosts)}},d=l,p=e("2877"),u=e("6b1d"),P=e("54e1"),g=e("eebe"),m=e.n(g),w=Object(p["a"])(d,i,o,!1,null,null,null);t["default"]=w.exports;m()(w,"components",{QLinearProgress:u["a"],QBanner:P["a"]})}}]);