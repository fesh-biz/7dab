(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"419d":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row justify-center q-px-sm"},[s("div",{staticClass:"col-sm-12 col-xs-12 col-md-8 col-lg-6 col-xl-5 q-mt-md"},[s("q-card",{staticClass:"q-my-md",attrs:{flat:t.$q.platform.is.mobile}},[s("q-card-section",[s("q-input",{attrs:{outlined:"",dense:"",label:t.$t("title"),error:!!t.postEditor.validator.errors.title,"error-message":t.postEditor.validator.errors.title},on:{input:function(e){return t.postEditor.validator.resetFieldError("title")}},model:{value:t.postEditor.formModel.title,callback:function(e){t.$set(t.postEditor.formModel,"title",e)},expression:"postEditor.formModel.title"}}),s("div",{staticClass:"ap-body"},t._l(t.postEditor.formModel.sections,(function(e,i){return s("div",{key:"body-element"+e.order,staticClass:"q-mb-md"},[s("div",[s("icon-with-tooltip",{attrs:{tooltip:t.$t("delete_section"),icon:"delete"},on:{click:function(e){return t.postEditor.deleteSection(i)}}})],1),s(e.type+"-field",{ref:"editor["+e.order+"]",refInFor:!0,tag:"component",attrs:{content:e.content,order:e.order,"error-message":t.getSectionError(e.order)},on:{input:function(s){return t.postEditor.validator.resetFieldError("sections",e.order)}}})],1)})),0),s("tag-field",{attrs:{"error-message":t.tagError},on:{input:t.updatePostTags}})],1),s("q-card-section",{staticClass:"flex justify-between"},[s("q-inner-loading",{attrs:{showing:t.isBusy,color:"positive"}}),s("div",{staticClass:"inline-block"},[s("icon-with-tooltip",{attrs:{tooltip:t.$t("add_text"),color:"positive",disabled:t.isBusy,size:"xl",icon:"notes"},on:{click:function(e){return t.postEditor.addSection("text")}}}),s("icon-with-tooltip",{attrs:{tooltip:t.$t("add_image"),color:"positive",disabled:t.isBusy,size:"xl",icon:"image"},on:{click:function(e){return t.postEditor.addSection("image")}}})],1),s("div",{staticClass:"inline-block"},[s("icon-with-tooltip",{attrs:{tooltip:t.$t("cancel"),color:"negative",disabled:t.isBusy,size:"xl",icon:"cancel"}}),s("icon-with-tooltip",{attrs:{tooltip:t.$t("save"),color:"positive",disabled:t.isBusy,size:"xl",icon:"check_circle"},on:{click:function(e){return t.saveOrUpdate()}}})],1)],1)],1)],1)])},o=[],r=(s("e6cf"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"wrapper",staticClass:"flex justify-center",class:{error:t.errorMessage}},[t.isImageAdded||t.content&&t.content.url?s("div",{staticStyle:{width:"100%"}},[s("icon-with-tooltip",{staticClass:"cursor-pointer",attrs:{size:"2rem",icon:"change_circle",tooltip:t.$t("change_image")},on:{click:t.addImages}})],1):t._e(),t.isImageAdded?t._e():s("q-icon",{staticClass:"cursor-pointer",staticStyle:{"background-color":"white"},attrs:{size:"10rem",color:"blue-grey-2",name:"add_a_photo"},on:{click:t.addImages}}),s("canvas",{ref:"canvas",attrs:{width:this.wrapperWidth,height:"0"}}),s("q-input",{staticStyle:{width:"100%"},attrs:{dense:"",label:t.$t("add_image_label"),"stack-label":""},on:{input:t.input},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t.errorMessage?s("span",{staticStyle:{color:"red",width:"100%"}},[t._v(t._s(t.errorMessage))]):t._e()],1)}),n=[],a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-icon",{staticClass:"cursor-pointer",class:{"iwt-disabled":this.disabled},attrs:{name:t.icon,color:t.color,size:t.size},on:{click:t.click}},[s("q-tooltip",{attrs:{"transition-show":"scale","transition-hide":"scale",self:"bottom middle",anchor:"top middle"}},[t._v("\n    "+t._s(t.tooltip)+"\n  ")])],1)},l=[],c={name:"IconWithToolTip",props:{icon:{type:String,required:!0},tooltip:{type:String,required:!0},color:{type:String,default:""},size:{type:String,default:"md"},disabled:{type:Boolean,default:!1}},data(){return{}},methods:{click(){this.disabled||this.$emit("click")}}},d=c,p=(s("8643"),s("2877")),u=s("0016"),h=s("05c0"),m=s("eebe"),f=s.n(m),g=Object(p["a"])(d,a,l,!1,null,null,null),v=g.exports;f()(g,"components",{QIcon:u["a"],QTooltip:h["a"]});var w=s("6357"),y=s("7cbd"),b=s("2ef0"),E=s.n(b),_=s("5e86"),$=s("2a19");const M={title:"",sections:[],tags:[]};class I{constructor(){if(I.instance)return I.instance;this.formModel=E.a.cloneDeep(M),this.api=new y["a"],this.validator=new w["a"](M),I.instance=this}addSection(t,e,s){const i=this.formModel.sections.length?this.formModel.sections[this.formModel.sections.length-1].order+1:1;this.formModel.sections.push({id:s,order:i,type:t,content:e||null})}addSections(t,e,s){s.forEach((e=>{e instanceof File&&this.addSection(t,{file:e})}))}deleteSection(t){const e=this.formModel.sections[t];this.formModel.sections.splice(t,1),this.validator.resetFieldError("sections",e.order)}fillFormModel(t){this.formModel=E.a.cloneDeep(M);const e=_["a"].query().withAll().find(t);this.formModel.title=e.title,e.content.forEach((t=>{"text"===t.type&&this.addSection("text",t.body,t.id),"image"===t.type&&this.addSection("image",{url:t.original_file_path,title:t.title},t.id)}));const s=[];e.tags.forEach((t=>{s.push({label:t.title,value:t.id})})),this.formModel.tags=s}updateSection(t,e){const s=E.a.find(this.formModel.sections,{order:t});"text"!==s.type?"image"===s.type&&(s.content=s.content||{file:null,url:null,title:null},s.content=Object.assign(s.content,e)):s.content=e}resetFormModel(){this.formModel=E.a.cloneDeep(M)}getFormData(){const t=this.formModel,e=new FormData;e.append("title",t.title);for(let s=0;s<t.sections.length;s++){const i=t.sections[s];if(i.id&&e.append(`sections[${s}][id]`,i.id),e.append(`sections[${s}][type]`,i.type),e.append(`sections[${s}][order]`,i.order),"image"===i.type){if(!i.content)continue;i.content.file&&e.append(`sections[${s}][content][file]`,i.content.file),e.append(`sections[${s}][content][url]`,i.content.url||""),e.append(`sections[${s}][content][title]`,i.content.title||"")}"text"===i.type&&e.append(`sections[${s}][content]`,i.content||"")}for(let s=0;s<t.tags.length;s++){const i=t.tags[s];i.value?e.append(`tags[${s}][id]`,i.value):e.append(`tags[${s}][new]`,i)}return e}clearAllEmptyFields(){this.formModel.sections=this.formModel.sections.filter((t=>t.content))}saveOrUpdate(t){return new Promise(((e,s)=>{if(this.clearAllEmptyFields(),!this.formModel.sections.length)return $["a"].create({position:"center",color:"negative",message:"Теревенька маэ мати хоча б одне текстове поле або поле з зображенням"}),s();const i=this.getFormData(),o=t?"update":"store";this.api[o](i,t).then((t=>e(t))).catch((t=>{this.validator.setErrors(t),s(t)}))}))}}var S={name:"ImageField",components:{IconWithTooltip:v},props:{content:{type:Object,default:null},order:{type:Number,required:!0},errorMessage:{type:[String]}},data(){return{wrapperWidth:0,isImageAdded:!1,postEditor:new I}},computed:{title:{get(){var t;return(null===(t=this.content)||void 0===t?void 0:t.title)||""},set(t){this.postEditor.updateSection(this.order,{title:t})}}},async mounted(){this.wrapperWidth=this.$refs.wrapper.offsetWidth,this.content?this.content.file?this.drawImage(this.content.file):this.content.url&&this.drawImageFromUrl(this.content.url):this.addImages()},methods:{input(){this.$emit("input")},addImages(){this.$emit("input");const t=document.createElement("input");t.type="file",t.multiple=!0,t.onchange=t=>{this.handleImages(t.target.files)},t.click()},drawImage(t){const e=this.$refs.canvas,s=e.getContext("2d"),i=new FileReader;i.onload=t=>{const i=new Image;i.onload=()=>{let t=i.width,o=i.height;t>this.wrapperWidth&&(o*=this.wrapperWidth/t,t=this.wrapperWidth),e.width=t,e.height=o,s.drawImage(i,0,0,i.width,i.height,0,0,t,o),this.isImageAdded=!0},i.src=t.target.result},i.readAsDataURL(t)},async drawImageFromUrl(t){const e=await fetch(t),s=await e.blob(),i={type:"image/jpeg"};let o=t;o=o.substr(o.lastIndexOf("/")+1);const r=new File([s],o,i);this.drawImage(r)},handleImages(t){const e=this.validateImages(t);if(e)return void this.$q.notify({message:e,position:"center",color:"negative"});const s=t[0];this.drawImage(s),this.postEditor.updateSection(this.order,{file:s});const i=[];for(let o=0;o<t.length;o++)o>0&&i.push(t[o]);this.postEditor.addSections("image",this.order,i)},validateImages(t){let e=null;const s=/(jpg)|(png)|(jpeg)/i;for(let i=0;i<t.length;i++){s.test(t[i].type)||(e=this.$t("wrong_image_file_allowed_types")+": jpg, jpeg, png");const o=5e3;if(t[i].size>1024*o&&(e=this.$t("max_allowed_filesize")+" "+o+"Kb"),e)break}return e}}},x=S,q=s("27f9"),k=Object(p["a"])(x,r,n,!1,null,null,null),F=k.exports;f()(k,"components",{QIcon:u["a"],QInput:q["a"]});var P=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:{error:t.errorMessage}},[s("q-input",{ref:"textField",attrs:{type:"textarea",autogrow:"",outlined:""},on:{input:t.input},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}}),t.errorMessage?s("span",{staticStyle:{color:"red"}},[t._v(t._s(t.errorMessage))]):t._e()],1)},C=[],j=(s("5319"),{name:"PostForm",props:{content:{type:String,required:""},order:{type:Number,required:!0},errorMessage:{type:[String]}},data(){return{model:"",postEditor:new I}},watch:{model(t){this.postEditor.updateSection(this.order,t)}},created(){this.model=this.replaceBr(this.content)},methods:{input(){this.$emit("input",this.model)},replaceBr(t){return t?t.replace(/<br>/g,""):""}}}),T=j,A=Object(p["a"])(T,P,C,!1,null,null,null),B=A.exports;f()(A,"components",{QInput:q["a"]});var O=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:{error:t.errorMessage}},[s("q-select",{attrs:{label:t.$t("tags"),options:t.options,"use-input":"","use-chips":"",multiple:"","option-disable":"inactive","hide-dropdown-icon":"",outlined:"","input-debounce":"300","new-value-mode":"add-unique"},on:{input:function(e){return t.$emit("input",t.model)},filter:t.filterFn},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}}),t.errorMessage?s("span",{staticStyle:{color:"red"}},[t._v(t._s(t.errorMessage))]):t._e()],1)},z=[],Q=s("89d6"),W={name:"TagField",props:{errorMessage:{type:String,default:null},tags:{type:Array,default:null}},data(){return{options:[],tagApi:new Q["a"],postEditor:new I,fetching:!1}},computed:{model:{get(){return this.postEditor.formModel.tags},set(t){this.postEditor.formModel.tags=t}}},methods:{filterFn(t,e){if(""===t)return void e((()=>{}));const s=t.toLowerCase();this.options=[],this.tagApi.search(s).then((t=>{const s=t.data.data,i=[];s.forEach((t=>{i.push({label:t.title,value:t.id,inactive:"rejected"===t.status})})),e((()=>{this.options=i}))}))}}},D=W,U=s("ddd8"),L=Object(p["a"])(D,O,z,!1,null,null,null),N=L.exports;f()(L,"components",{QSelect:U["a"]});var R=s("a31e"),J={name:"AddPost",components:{TooltipIcon:R["a"],ImageField:F,TextField:B,IconWithTooltip:v,TagField:N},data(){return{postEditor:new I,postApi:new y["a"],isBusy:!1}},computed:{sectionsErrors(){return this.postEditor.validator.errors.sections},isEditing(){return"editPost"===this.$route.name},postId(){return this.$route.params.id},post(){return _["a"].query().withAll().find(this.postId)},tagError(){return this.postEditor.validator.errors.tags||null}},created(){this.isEditing&&!this.post&&this.fetchPost().then((t=>{_["a"].insert({data:t.data.data}),this.postEditor.fillFormModel(this.postId)})),this.isEditing||this.postEditor.addSection("text")},beforeDestroy(){this.postEditor.resetFormModel()},methods:{fetchPost(){return new Promise(((t,e)=>{this.isBusy=!0,this.postApi.fetchPost(this.postId).then((e=>{this.isBusy=!1,t(e)})).catch((()=>{this.isBusy=!1}))}))},getSectionError(t){const e=this.postEditor.validator.errors.sections;return e?"string"===typeof e?this.$t("all_fields_must_be_filled"):e[t]:null},saveOrUpdate(){this.isBusy=!0,this.postEditor.saveOrUpdate(this.postId).then((t=>{this.isBusy=!1;const e=t.data.data,s=e.id;this.isEditing||(_["a"].create({data:t.data.data}),this.$router.push({name:"editPost",params:{id:s}}))})).catch((()=>{this.isBusy=!1}))},updatePostTags(t){this.postEditor.validator.errors.tags=null},crtlSHandler(t){document.addEventListener("keydown",(t=>{t.ctrlKey&&"s"===t.key&&(t.preventDefault(),console.log("CTRL + S"))}))}}},K=J,H=s("f09f"),G=s("a370"),V=s("74f7"),X=Object(p["a"])(K,i,o,!1,null,null,null);e["default"]=X.exports;f()(X,"components",{QCard:H["a"],QCardSection:G["a"],QInput:q["a"],QInnerLoading:V["a"]})},6357:function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var i=s("8847");class o{constructor(t){this.formModel=t,this.errors={error_message:null},this.formModel&&this.resetErrors()}setError(t,e){this.errors[t]=e[t]?e[t][0]:null}setErrors(t){const e=t.response.data.errors;if(e){for(const s in e)if(e.hasOwnProperty(s)){if("error_message"===s){this.errors.error_message=e[s];continue}this.errors[s]=e[s][0]||e[s]}}else{const e={invalid_grant:i["b"].messages[i["b"].locale].wrong_credentials,invalid_request:i["b"].messages[i["b"].locale].check_your_data},s=t.response.data.error;this.errors.error_message=e[s]||null}}resetFieldError(t,e){this.errors[t]&&(e?"string"===typeof this.errors[t]?this.errors[t]=null:this.errors[t][e]=null:this.errors[t]=null),this.errors.error_message=null}resetErrors(){for(const t in this.formModel)this.formModel.hasOwnProperty(t)&&(this.errors[t]=null)}}},"7cbd":function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));s("e6cf");var i=s("77fc");class o{constructor(){if(o.instance)return o.instance;this.api=new i["a"],o.instance=this}fetchPost(t){return new Promise(((e,s)=>{this.api.get(`content/posts/${t}`).then((t=>{e(t)})).catch((t=>{s(t)}))}))}fetchPosts(t){return new Promise(((e,s)=>{this.api.get(`/content/posts?page=${t}`).then((t=>{e(t)})).catch((t=>{s(t)}))}))}store(t){return new Promise(((e,s)=>{this.api.post("/content/posts",t,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>e(t))).catch((t=>{s(t)}))}))}update(t,e){return new Promise(((s,i)=>{this.api.put(`/content/posts/${e}`,t,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>s(t))).catch((t=>{i(t)}))}))}}},8643:function(t,e,s){"use strict";s("e600")},"89d6":function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));s("e6cf");var i=s("77fc");class o{constructor(){if(o.instance)return o.instance;this.api=new i["a"],o.instance=this}search(t){return new Promise(((e,s)=>{this.api.get(`/tags/search?title=${t}`).then((t=>e(t))).catch((t=>s(t)))}))}update(t,e){return new Promise(((s,i)=>{this.api.put(`admin/tags/${t}`,e).then((t=>s(t))).catch((t=>i(t)))}))}}},a31e:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10],"transition-show":"scale","transition-hide":"scale"}},[t._v("\n    "+t._s(t.tooltip)+"\n  ")]),s("q-icon",{staticClass:"q-mr-xs",attrs:{size:t.iconSize,name:t.iconName},on:{click:function(e){return t.$emit("click")}}})],1)},o=[],r={name:"TooltipIcon",props:{tooltip:{type:String,required:!0},iconName:{type:String,required:!0},iconSize:{type:String,default:"sm"}},data(){return{}}},n=r,a=s("2877"),l=s("05c0"),c=s("0016"),d=s("eebe"),p=s.n(d),u=Object(a["a"])(n,i,o,!1,null,null,null);e["a"]=u.exports;p()(u,"components",{QTooltip:l["a"],QIcon:c["a"]})},e600:function(t,e,s){}}]);