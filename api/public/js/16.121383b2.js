(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{bf17:function(t,o,e){"use strict";e.r(o);var s=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",{staticClass:"row justify-center q-px-sm"},[e("div",{staticClass:"col-sm-12 col-xs-12 col-md-8 col-lg-6 col-xl-5 q-mt-md"},[e("q-card",{staticClass:"q-my-md",attrs:{flat:t.$q.platform.is.mobile}},[e("q-card-section",[e("q-input",{attrs:{outlined:"",dense:"",label:t.$t("title"),error:!!t.postEditor.validator.errors.title,"error-message":t.postEditor.validator.errors.title},on:{input:function(o){return t.postEditor.validator.resetFieldError("title")}},model:{value:t.postEditor.formModel.title,callback:function(o){t.$set(t.postEditor.formModel,"title",o)},expression:"postEditor.formModel.title"}}),e("div",{staticClass:"ap-body"},t._l(t.postEditor.formModel.sections,(function(o,s){return e("div",{key:"body-element"+o.order,staticClass:"q-mb-md"},[e("div",[e("icon-with-tooltip",{attrs:{tooltip:t.$t("delete_section"),icon:"delete"},on:{click:function(o){return t.postEditor.deleteSection(s)}}})],1),e(o.type+"-field",{ref:"editor["+o.order+"]",refInFor:!0,tag:"component",attrs:{content:o.content,order:o.order,"error-message":t.getSectionError(o.order)},on:{input:function(e){return t.postEditor.validator.resetFieldError("sections",o.order)}}})],1)})),0),e("tag-field",{attrs:{"error-message":t.tagError},on:{input:t.updatePostTags}})],1),t.postEditor.validator.mainErrorMessage?e("q-card-section",{staticClass:"flex justify-center"},[e("div",{staticClass:"q-pa-md",staticStyle:{color:"white","background-color":"red","border-radius":"5px"}},[t._v("\n          "+t._s(t.postEditor.validator.mainErrorMessage)+"\n        ")])]):t._e(),t.postEditor.totalImages?e("q-card-section",{staticClass:"flex justify-center"},[e("div",{class:{"main-error-message":t.postEditor.totalImages>t.postEditor.totalImagesMax}},[t._v("\n          "+t._s(t.$t("total_number_of_images"))+":\n          "+t._s(t.postEditor.totalImages)+"\n          ("+t._s(t.$t("maximum"))+": "+t._s(t.postEditor.totalImagesMax)+")\n        ")])]):t._e(),e("q-card-section",{staticClass:"flex justify-between"},[e("q-inner-loading",{attrs:{showing:t.isBusy,color:"positive"}}),e("div",{staticClass:"inline-block"},[e("icon-with-tooltip",{attrs:{tooltip:t.$t("add_text"),color:"positive",disabled:t.isBusy,size:"xl",icon:"notes"},on:{click:function(o){return t.postEditor.addSection("text")}}}),e("icon-with-tooltip",{attrs:{tooltip:t.$t("add_image"),color:"positive",disabled:t.isBusy,size:"xl",icon:"image"},on:{click:function(o){return t.postEditor.addSection("image")}}})],1),e("div",{staticClass:"inline-block"},[t.canBeViewed?e("icon-with-tooltip",{attrs:{tooltip:t.$t("preview"),color:"positive",disabled:t.isBusy,size:"xl",icon:"pageview"},on:{click:function(o){return t.$router.push({name:"postPage",params:{id:t.postId}})}}}):t._e(),e("icon-with-tooltip",{attrs:{tooltip:t.$t("cancel"),color:"negative",disabled:t.isBusy,size:"xl",icon:"cancel"},on:{click:t.goBack}}),e("icon-with-tooltip",{attrs:{tooltip:t.$t("save"),color:"positive",disabled:t.isBusy,size:"xl",icon:"check_circle"},on:{click:function(o){return t.saveOrUpdate()}}})],1)],1)],1)],1)])},i=[],r=(e("e6cf"),e("ddb0"),e("5440")),a=e("e118"),n=e("a010"),d=e("a31e"),l=e("51d9"),c=e("4f9d"),p=e("5e86"),u=e("7cbd"),m=e("ee7a"),f=e("f67e"),h={name:"AddPost",components:{TooltipIcon:d["a"],ImageField:r["a"],TextField:a["a"],IconWithTooltip:l["a"],TagField:n["a"]},data(){return{postEditor:new c["a"],postApi:new u["a"],isBusy:!1,canBeViewed:!1}},computed:{sectionsErrors(){return this.postEditor.validator.errors.sections},isEditing(){return"editPost"===this.$route.name},postId(){return this.$route.params.id},post(){return p["a"].query().withAll().find(this.postId)},tagError(){return this.postEditor.validator.errors.tags||null}},async created(){if(!this.post){const t=await this.fetchPost();await p["a"].insert({data:t.data.data})}this.$nextTick((()=>{this.canBeViewed=!0,this.postEditor.fillFormModel(this.postId)}))},beforeDestroy(){this.postEditor.resetFormModel(),this.postEditor.validator.resetErrors()},methods:{goBack(){window.history.back()},fetchPost(){return new Promise(((t,o)=>{this.isBusy=!0,this.postApi.fetchPost(this.postId).then((o=>{this.isBusy=!1,t(o)})).catch((()=>{this.isBusy=!1}))}))},getSectionError(t){const o=this.postEditor.validator.errors.sections;return o&&"string"!==typeof o?o[t]:null},async removeCache(t){const o=p["a"].query().withAll().find(t);if(o.post_images){const t=o.post_images.map((t=>t.id));for(const o of t)await m["a"].delete(o)}if(o.post_texts){const t=o.post_texts.map((t=>t.id));for(const o of t)await f["a"].delete(o)}},async saveOrUpdate(){this.isBusy=!0,await this.removeCache(this.postId),this.postEditor.saveOrUpdate(this.postId).then((async t=>{this.isBusy=!1;const o=t.data.data,e=o.id;await p["a"].insertOrUpdate({where:e,data:o}),this.postEditor.fillFormModel(e),this.$q.notify({message:this.$t("success"),position:"center",color:"positive"})})).catch((t=>{this.isBusy=!1}))},updatePostTags(){this.postEditor.validator.resetFieldError("tags")},crtlSHandler(t){document.addEventListener("keydown",(t=>{t.ctrlKey&&"s"===t.key&&(t.preventDefault(),console.log("CTRL + S"))}))}}},g=h,v=e("2877"),E=e("f09f"),w=e("a370"),y=e("27f9"),b=e("74f7"),_=e("eebe"),x=e.n(_),k=Object(v["a"])(g,s,i,!1,null,null,null);o["default"]=k.exports;x()(k,"components",{QCard:E["a"],QCardSection:w["a"],QInput:y["a"],QInnerLoading:b["a"]})}}]);