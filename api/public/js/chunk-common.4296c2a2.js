(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"01a2":function(t,e,s){"use strict";s("247c")},"09ad":function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));s("e6cf");class i{constructor(){if(i.instance)return i.instance;i.instance=this}isScrollBottom(t){const e=document.documentElement.offsetHeight,s=window.innerHeight,i=window.scrollY||window.pageYOffset||document.body.scrollTop+(document.documentElement&&document.documentElement.scrollTop||0);return e<=s+i+(t||0)}whenScrollFinished(){let t=0,e=window.scrollX,s=window.scrollY;return new Promise((i=>{function n(o){o>=500||o-t>20?i():(window.scrollX===e&&window.scrollY===s||(t=o,e=window.scrollX,s=window.scrollY),requestAnimationFrame(n.bind(null,o+1)))}n(0)}))}}},"247c":function(t,e,s){},"2b16":function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));s("e6cf");var i=s("77fc");class n{constructor(){if(n.instance)return n.instance;this.api=new i["a"],n.instance=this}async fetch(t,e){try{return await this.api.get("content/comments",{commentable_id:t,commentable_type:e},"comments")}catch(s){console.error(s)}}create(t){return new Promise(((e,s)=>{this.api.post("content/comments",t,null,"comments").then((t=>e(t))).catch((t=>s(t)))}))}update(t,e){return new Promise(((s,i)=>{this.api.post(`content/comments/${t}`,{body:e},null,"comments").then((t=>s(t))).catch((t=>i(t)))}))}}},"4f9d":function(t,e,s){"use strict";s.d(e,"a",(function(){return d}));s("e6cf");var i=s("6357"),n=s("7cbd"),o=s("2ef0"),a=s.n(o),r=s("5e86"),l=s("2a19");const c={title:"",sections:[],tags:[]};class d{constructor(){if(d.instance)return d.instance;this.formModel=a.a.cloneDeep(c),this.api=new n["a"],this.totalImages=0,this.totalImagesMax=10,this.validator=new i["a"](c),d.instance=this}addSection(t,e,s){const i=this.formModel.sections.length?this.formModel.sections[this.formModel.sections.length-1].order+1:1;e=e||null,"youtube"!==t||e||(e={youtube_id:null,title:null}),this.formModel.sections.push({id:s,order:i,type:t,content:e}),"image"===t&&this.totalImages++}addSections(t,e,s){s.forEach((e=>{e instanceof File&&this.addSection(t,{file:e})}))}deleteSection(t){const e=this.formModel.sections[t];"image"===(null===e||void 0===e?void 0:e.type)&&(this.totalImages--,this.totalImages<0&&(this.totalImages=0)),this.formModel.sections.splice(t,1),this.validator.resetFieldError("sections",e.order)}fillFormModel(t){this.totalImages=0,this.formModel=a.a.cloneDeep(c);const e=r["a"].query().withAll().find(t);this.formModel.title=e.title;const s=t=>{const e={text:t=>{this.addSection("text",t.body,t.id)},image:t=>{this.addSection("image",{url:t.original_file_path,title:t.title},t.id)},youtube:t=>{this.addSection("youtube",{youtube_id:t.youtube_id},t.id)}},s=t.type;if(!e[s])throw new Error("Section with given type "+s+" doesn't exists");e[s](t)};e.content.forEach((t=>{s(t)}));const i=[];e.tags.forEach((t=>{i.push({label:t.title,value:t.id})})),this.formModel.tags=i}updateSection(t,e){const s=a.a.find(this.formModel.sections,{order:t});"image"===s.type?"image"===s.type&&(s.content=s.content||{file:null,url:null,title:null},s.content=Object.assign(s.content,e)):s.content=e}resetFormModel(){this.formModel=a.a.cloneDeep(c),this.totalImages=0}getSectionsWithCorrectOrders(t){t=a.a.sortBy(this.formModel.sections,"order");let e=1;return t=t.map((t=>(t.order=e,e++,t))),t}getFormData(){this.formModel.sections=this.getSectionsWithCorrectOrders(this.formModel.sections);const t=this.formModel,e=new FormData;e.append("title",t.title);for(let s=0;s<t.sections.length;s++){const i=t.sections[s];if(i.id&&e.append(`sections[${s}][id]`,i.id),e.append(`sections[${s}][type]`,i.type),e.append(`sections[${s}][order]`,i.order),"image"===i.type){if(!i.content)continue;i.content.file&&e.append(`sections[${s}][content][file]`,i.content.file),e.append(`sections[${s}][content][url]`,i.content.url||""),e.append(`sections[${s}][content][title]`,i.content.title||"")}"text"===i.type&&e.append(`sections[${s}][content]`,i.content||""),"youtube"===i.type&&e.append(`sections[${s}][content][youtube_id]`,i.content.youtube_id)}for(let s=0;s<t.tags.length;s++){const i=t.tags[s];i.value?e.append(`tags[${s}][id]`,i.value):e.append(`tags[${s}][new]`,i)}return e}clearAllEmptyFields(){this.formModel.sections=this.formModel.sections.filter((t=>"youtube"===t.type?!!t.content.youtube_id:!!t.content))}saveOrUpdate(t){return new Promise(((e,s)=>{if(this.clearAllEmptyFields(),!this.formModel.sections.length)return l["a"].create({position:"center",color:"negative",message:"Теревенька має мати хоча б одне заповнене поле"}),s();const i=this.getFormData(),n=t?"update":"store";this.api[n](i,t).then((t=>e(t))).catch((t=>{this.validator.setErrors(t),s(t)}))}))}}},"51d9":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-icon",{staticClass:"cursor-pointer",class:{"iwt-disabled":this.disabled},attrs:{name:t.icon,color:t.color,size:t.size},on:{click:t.click}},[s("q-tooltip",{attrs:{"transition-show":"scale","transition-hide":"scale",self:"bottom middle",anchor:"top middle"}},[t._v("\n    "+t._s(t.tooltip)+"\n  ")])],1)},n=[],o={name:"IconWithToolTip",props:{icon:{type:String,required:!0},tooltip:{type:String,required:!0},color:{type:String,default:""},size:{type:String,default:"md"},disabled:{type:Boolean,default:!1}},data(){return{}},methods:{click(){this.disabled||this.$emit("click")}}},a=o,r=(s("8643"),s("2877")),l=s("0016"),c=s("05c0"),d=s("eebe"),u=s.n(d),p=Object(r["a"])(a,i,n,!1,null,null,null);e["a"]=p.exports;u()(p,"components",{QIcon:l["a"],QTooltip:c["a"]})},5440:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"wrapper",staticClass:"flex justify-center",class:{error:t.errorMessage}},[t.isImageAdded||t.content&&t.content.url?s("div",{staticStyle:{width:"100%"}},[s("icon-with-tooltip",{staticClass:"cursor-pointer",attrs:{size:"2rem",icon:"change_circle",tooltip:t.$t("change_image")},on:{click:t.addImages}})],1):t._e(),t.isImageAdded?t._e():s("q-icon",{staticClass:"cursor-pointer",staticStyle:{"background-color":"white"},attrs:{size:"10rem",color:"blue-grey-2",name:"add_a_photo"},on:{click:t.addImages}}),s("canvas",{ref:"canvas",attrs:{width:this.wrapperWidth,height:"0"}}),s("q-input",{staticStyle:{width:"100%"},attrs:{dense:"",label:t.$t("add_image_label"),"stack-label":""},on:{input:t.input},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t.errorMessage?s("span",{staticStyle:{color:"red",width:"100%"}},[t._v(t._s(t.errorMessage))]):t._e()],1)},n=[],o=(s("e6cf"),s("51d9")),a=s("4f9d"),r={name:"ImageField",components:{IconWithTooltip:o["a"]},props:{content:{type:Object,default:null},order:{type:Number,required:!0},errorMessage:{type:[String]}},data(){return{wrapperWidth:0,isImageAdded:!1,postEditor:new a["a"]}},computed:{title:{get(){var t;return(null===(t=this.content)||void 0===t?void 0:t.title)||""},set(t){this.postEditor.updateSection(this.order,{title:t})}}},async mounted(){this.wrapperWidth=this.$refs.wrapper.offsetWidth,this.content?this.content.file?this.drawImage(this.content.file):this.content.url&&this.drawImageFromUrl(this.content.url):this.addImages()},methods:{input(){this.$emit("input")},addImages(){this.$emit("input");const t=document.createElement("input");t.type="file",t.multiple=!0,t.onchange=t=>{this.handleImages(t.target.files)},t.click()},drawImage(t){const e=this.$refs.canvas,s=e.getContext("2d"),i=new FileReader;i.onload=t=>{const i=new Image;i.onload=()=>{let t=i.width,n=i.height;t>this.wrapperWidth&&(n*=this.wrapperWidth/t,t=this.wrapperWidth),e.width=t,e.height=n,s.drawImage(i,0,0,i.width,i.height,0,0,t,n),this.isImageAdded=!0},i.src=t.target.result},i.readAsDataURL(t)},async drawImageFromUrl(t){const e=await fetch(t),s=await e.blob(),i={type:"image/jpeg"};let n=t;n=n.substr(n.lastIndexOf("/")+1);const o=new File([s],n,i);this.drawImage(o)},handleImages(t){const e=this.validateImages(t);if(e)return void this.$q.notify({message:e,position:"center",color:"negative"});const s=t[0];this.drawImage(s),this.postEditor.updateSection(this.order,{file:s});const i=[];for(let n=0;n<t.length;n++)n>0&&i.push(t[n]);this.postEditor.addSections("image",this.order,i)},validateImages(t){let e=null;const s=/(jpg)|(png)|(jpeg)/i;for(let i=0;i<t.length;i++){s.test(t[i].type)||(e=this.$t("wrong_image_file_allowed_types")+": jpg, jpeg, png");const n=5e3;if(t[i].size>1024*n&&(e=this.$t("max_allowed_filesize")+" "+n+"Kb"),e)break}return e}}},l=r,c=s("2877"),d=s("0016"),u=s("27f9"),p=s("eebe"),m=s.n(p),h=Object(c["a"])(l,i,n,!1,null,null,null);e["a"]=h.exports;m()(h,"components",{QIcon:d["a"],QInput:u["a"]})},"5899c":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"field"},[s("q-input",{staticClass:"q-mb-md",attrs:{dense:"",outlined:"",label:t.$t("insert_youtube_link")},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}}),t.isFetching?s("q-linear-progress",{staticClass:"q-my-lg",attrs:{indeterminate:""}}):t._e(),t.videoId&&!t.isFetching?s("you-tube",{ref:"youtube",attrs:{"video-id":t.videoId}}):t._e()],1)},n=[];s("e6cf"),s("5319");class o{constructor(){if(o.instance)return o.instance;o.instance=this}getUrlQueryVars(t){const e={};return t.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(t,s,i){e[s]=i})),e}}var a=s("f724"),r=s("bc3a"),l=s.n(r),c={name:"YouTubeField",components:{YouTube:a["a"]},props:{value:{type:Object,required:!0}},data(){return{url:new o,videoId:null,model:null,isFetching:!1}},watch:{model(t){this.onInput(t)}},created(){this.value.youtube_id&&(this.videoId=this.value.youtube_id,this.model="https://www.youtube.com/watch?v="+this.value.youtube_id)},methods:{async onInput(){try{this.videoId=null,this.isFetching=!0;const t=await l.a.get(`https://www.youtube.com/oembed?url=${this.model}&format=json`),e=t.data.html.match(/embed\/(.*)\?/)[1];this.isFetching=!1,this.model="https://www.youtube.com/watch?v="+e,this.videoId=e,this.$emit("input",{youtube_id:this.videoId}),setTimeout((()=>{this.$refs.youtube.updateSrc(this.videoId)}),10)}catch(t){this.isFetching=!1,this.$q.notify({color:"negative",message:"Invalid YouTube video URL"})}}}},d=c,u=s("2877"),p=s("27f9"),m=s("6b1d"),h=s("eebe"),g=s.n(h),f=Object(u["a"])(d,i,n,!1,null,null,null);e["a"]=f.exports;g()(f,"components",{QInput:p["a"],QLinearProgress:m["a"]})},"5fb2":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-chip",{attrs:{color:t.bgColor,size:"0.8rem"}},[s("q-avatar",[t.avatar?s("img",{attrs:{src:"https://cdn.quasar.dev/img/avatar5.jpg"}}):t._e(),t.avatar?t._e():s("q-icon",{staticStyle:{"margin-top":"-3px"},attrs:{color:t.isPostAuthor?"white":"grey-8",name:"account_circle",size:"2.3rem"}})],1),s("strong",{style:{color:t.isPostAuthor?"white":"#363636"}},[t._v(t._s(t.name))])],1)},n=[],o={name:"Author",props:{isPostAuthor:{type:Boolean,default:!0},avatar:{type:String,default:null},name:{type:String,required:!0}},data(){return{}},computed:{bgColor(){return this.isPostAuthor?"green-5":"light-blue-1"}}},a=o,r=s("2877"),l=s("b047"),c=s("cb32"),d=s("0016"),u=s("eebe"),p=s.n(u),m=Object(r["a"])(a,i,n,!1,null,null,null);e["a"]=m.exports;p()(m,"components",{QChip:l["a"],QAvatar:c["a"],QIcon:d["a"]})},6357:function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var i=s("8847");class n{constructor(t){this.formModel=t,this.errors={error_message:null},this.mainErrorMessage=null,this.formModel&&this.resetErrors()}setError(t,e){this.errors[t]=e[t]?e[t][0]:null}setErrors(t){var e,s,n,o;"The given data was invalid."!==(null===t||void 0===t||null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)&&(this.mainErrorMessage=null===t||void 0===t||null===(n=t.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message);const a=t.response.data.errors;if(a){for(const i in a)if(a.hasOwnProperty(i)){if("error_message"===i){this.errors.error_message=a[i];continue}this.errors[i]=a[i][0]||a[i]}}else{const e={invalid_grant:i["b"].messages[i["b"].locale].wrong_credentials,invalid_request:i["b"].messages[i["b"].locale].check_your_data},s=t.response.data.error;this.errors.error_message=e[s]||null}}resetFieldError(t,e){this.errors[t]&&(e?"string"===typeof this.errors[t]?this.errors[t]=null:this.errors[t][e]=null:this.errors[t]=null),this.errors.error_message=null,this.mainErrorMessage=null}resetErrors(){for(const t in this.formModel)this.formModel.hasOwnProperty(t)&&(this.errors[t]=null);this.errors.error_message=null,this.mainErrorMessage=null}}},"67f1":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"comment",attrs:{id:"comment-"+t.comment.id}},[s("div",{staticStyle:{"padding-left":"5px",color:"#5e5e5e"}},[s("div",{staticClass:"flex items-center q-pl-sm"},[s("rating",{attrs:{ratingable:t.comment,"ratingable-type":"comment"}}),s("author",{attrs:{name:t.comment.user.login,"is-post-author":t.comment.user.id===t.postAuthor.id,avatar:t.comment.user.avatar}})],1),s("div",{staticStyle:{margin:"10px 0 20px 10px"}},[t._v("\n      "+t._s(t.comment.body)+"\n    ")]),s("add-comment",{attrs:{"is-reply":"","commentable-id":t.comment.id,"commentable-type":"comment","post-id":t.postId}})],1),t.answers.length?s("div",{staticStyle:{"margin-left":"10px"},style:{borderLeft:t.levelBorderColor}},t._l(t.answers,(function(e,i){return s("comment",{key:e.id,attrs:{comment:e,level:t.level+1,"is-last":t.answers.length-1===i&&!t.isLast,"post-author":t.postAuthor,"post-id":t.postId}})})),1):t._e()])},n=[],o=(s("e6cf"),s("ddb0"),s("72cd")),a=s("d171"),r=s("5fb2"),l=s("f542"),c={name:"Comment",props:{postId:{type:Number,required:!0},comment:{type:Object,required:!0},level:{type:Number,required:!0},isLast:{type:Boolean,required:!0},postAuthor:{type:Object,required:!0}},components:{AddComment:l["a"],Author:r["a"],Rating:a["a"],Comment:()=>Promise.resolve().then(s.bind(null,"67f1"))},computed:{levelBorderColor(){const t=["#0d47a1","#1565c0","#1976d2","#1e88e5","#2196f3","#42a5f5","#64b5f6","#90caf9","#bbdefb","#e3f2fd"];return"1px solid "+t[(this.level+2)%10]},answers(){return o["a"].query().where((t=>"comments"===t.commentable_type_name&&t.commentable_id===this.comment.id)).orderBy("id","desc").with("rating").with("user").get()}},data(){return{}}},d=c,u=s("2877"),p=Object(u["a"])(d,i,n,!1,null,null,null);e["default"]=p.exports},"7cbd":function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));s("e6cf");var i=s("77fc");class n{constructor(){if(n.instance)return n.instance;this.api=new i["a"],n.instance=this}incrementViews(t){return new Promise(((e,s)=>{this.api.post(`content/posts/increment-views/${t}`).then((t=>e(t))).catch((t=>s(t)))}))}fetchPost(t,e){const s=e?`content/posts/${t}?preview=1`:`content/posts/${t}`;return new Promise(((t,e)=>{this.api.get(s,null,"posts").then((e=>{t(e)})).catch((t=>{e(t)}))}))}fetchPosts(t){return new Promise(((e,s)=>{this.api.get(`/content/posts?page=${t}`,null,"posts").then((t=>{e(t)})).catch((t=>{s(t)}))}))}store(t){return new Promise(((e,s)=>{this.api.post("/content/posts",t,{headers:{"Content-Type":"multipart/form-data"}},"posts").then((t=>e(t))).catch((t=>{s(t)}))}))}update(t,e){return new Promise(((s,i)=>{this.api.post(`/content/posts/${e}`,t,{headers:{"Content-Type":"multipartddd/form-data"}},"posts").then((t=>s(t))).catch((t=>{i(t)}))}))}}},8402:function(t,e,s){},8643:function(t,e,s){"use strict";s("e600")},"89d6":function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));s("e6cf");var i=s("77fc");class n{constructor(){if(n.instance)return n.instance;this.api=new i["a"],n.instance=this}fetchByIds(t){let e="";return t.forEach(((s,i)=>{e+=`tids[]=${s}`,i+1<t.length&&(e+="&")})),new Promise(((t,s)=>{this.api.get(`/tags/search?${e}`,null,"tags").then((e=>t(e))).catch((t=>s(t)))}))}search(t,e=5){return new Promise(((s,i)=>{this.api.get(`/tags/search?title=${t}&limit=${e}`,null,"tags").then((t=>s(t))).catch((t=>i(t)))}))}update(t,e){return new Promise(((s,i)=>{this.api.put(`admin/tags/${t}`,e).then((t=>s(t))).catch((t=>i(t)))}))}}},a010:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:{error:t.errorMessage}},[s("q-select",{ref:"tagField",attrs:{label:t.$t("tags"),options:t.options,"use-input":"","use-chips":"",multiple:"","option-disable":"inactive","hide-dropdown-icon":"",outlined:"","input-debounce":"300","new-value-mode":"add-unique"},on:{input:function(e){return t.$emit("input",t.model)},filter:t.filterFn,"input-value":function(e){return t.inputValue=e}},nativeOn:{keydown:function(e){return t.onKeyDown(e)}},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}}),t.errorMessage?s("span",{staticStyle:{color:"red"}},[t._v(t._s(t.errorMessage))]):t._e()],1)},n=[],o=s("89d6"),a=s("4f9d"),r={name:"TagField",props:{errorMessage:{type:String,default:null},tags:{type:Array,default:null}},data(){return{options:[],tagApi:new o["a"],postEditor:new a["a"],fetching:!1,inputValue:null,isFiltering:!1,commaTimeout:null}},computed:{model:{get(){return this.postEditor.formModel.tags},set(t){this.postEditor.formModel.tags=t}}},methods:{onKeyDown(t){(","===t.key||","===t.key&&t.shiftKey)&&(t.preventDefault(),this.$refs.tagField.add(this.inputValue),this.$refs.tagField.updateInputValue(""))},filterFn(t,e){if(""===t)return void e((()=>{}));const s=t.toLowerCase();this.options=[],this.isFiltering=!0,this.tagApi.search(s).then((t=>{const s=t.data.data,i=[];s.forEach((t=>{i.push({label:t.title,value:t.id,inactive:"rejected"===t.status})})),this.isFiltering=!1,e((()=>{this.options=i}))}))}}},l=r,c=s("2877"),d=s("ddd8"),u=s("eebe"),p=s.n(u),m=Object(c["a"])(l,i,n,!1,null,null,null);e["a"]=m.exports;p()(m,"components",{QSelect:d["a"]})},a31e:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10],"transition-show":"scale","transition-hide":"scale"}},[t._v("\n    "+t._s(t.tooltip)+"\n  ")]),s("q-icon",{staticClass:"q-mr-xs",attrs:{size:t.iconSize,name:t.iconName},on:{click:function(e){return t.$emit("click")}}})],1)},n=[],o={name:"TooltipIcon",props:{tooltip:{type:String,required:!0},iconName:{type:String,required:!0},iconSize:{type:String,default:"sm"}},data(){return{}}},a=o,r=s("2877"),l=s("05c0"),c=s("0016"),d=s("eebe"),u=s.n(d),p=Object(r["a"])(a,i,n,!1,null,null,null);e["a"]=p.exports;u()(p,"components",{QTooltip:l["a"],QIcon:c["a"]})},d171:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"q-mr-md",attrs:{dusk:t.ratingableType+"-"+t.ratingable.id+"-rating"}},[t.isSubmitting?s("q-linear-progress",{staticStyle:{"margin-top":"-4px"},attrs:{indeterminate:""}}):t._e(),s("q-btn",{attrs:{round:"",size:"0.6rem",color:t.isMyVotePositive?"green-8":"grey-6",icon:"thumb_up"},on:{click:function(e){return t.vote("up")}}}),s("q-chip",{attrs:{color:t.rating.color,"text-color":0===t.rating.result?"black":"white"}},[t._v("\n    "+t._s(t.rating.result)+"\n    "),s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[t._v("\n      "+t._s(t.rating.positiveVotes)+" - "+t._s(t.rating.negativeVotes)+"\n    ")])],1),s("q-btn",{attrs:{round:"",color:!1===t.isMyVotePositive?"red-8":"grey-6",size:"0.6rem",icon:"thumb_down"},on:{click:function(e){return t.vote("down")}}})],1)},n=[],o=(s("e6cf"),s("77fc"));class a{constructor(){if(a.instance)return a.instance;this.api=new o["a"],a.instance=this}vote(t,e,s){return new Promise(((i,n)=>{this.api.post("/ratings/vote",{id:e,type:t,is_upvote:s},null,"my_votes").then((t=>i(t))).catch((t=>n(t)))}))}}var r=s("e93d"),l=s("a256"),c=s("b65d"),d=s("891a"),u={name:"Rating",props:{ratingable:{type:Object,required:!0},ratingableType:{type:String,required:!0}},data(){return{isSubmitting:!1,ratingApi:new a,meCookies:new c["a"]}},computed:{me(){return d["a"].query().first()},ratingInstance(){return l["a"].query().where((t=>t.ratingable_id===this.ratingable.id&&t.ratingable_type_name===this.ratingableTypePlural)).first()},rating(){const t=this.ratingInstance,e=(null===t||void 0===t?void 0:t.positive_votes)||0,s=(null===t||void 0===t?void 0:t.negative_votes)||0,i=e-s;return{positiveVotes:e,negativeVotes:s,result:i,color:(()=>{let t="light-blue-1";return i>0?t="green-5":i<0&&(t="red-5"),t})()}},ratingableTypePlural(){return this.ratingableType+"s"},isMyVotePositive(){if(!this.me)return null;const t=r["a"].query().where((t=>t.user_id===this.me.id&&t.ratingable_id===this.ratingable.id&&t.ratingable_type_name===this.ratingableTypePlural)).first();return t?t.is_positive:null}},methods:{vote(t){if(!this.meCookies.get())return void this.$q.notify({message:this.$t("need_to_login_or_register"),position:"center",color:"negative"});if("up"===t&&this.isMyVotePositive||"down"===t&&!1===this.isMyVotePositive)return;const e=null!==this.isMyVotePositive;this.isSubmitting=!0,this.ratingApi.vote(this.ratingableType,this.ratingable.id,"up"===t).then((async s=>{this.isSubmitting=!1,await r["a"].insertOrUpdate({data:s.data}),await this.updateRating(t,e),this.$q.notify({message:this.$t("your_vote_is_accepted"),position:"center",color:"green"})})).catch((t=>{this.isSubmitting=!1,this.$q.notify({message:t.response.data.message,position:"center",color:"red"})}))},async updateRating(t,e){if(this.ratingInstance){let s=this.ratingInstance.positive_votes,i=this.ratingInstance.negative_votes;"up"===t?(s++,e&&i--):(i++,e&&s--),await l["a"].update({where:this.ratingInstance.id,data:{positive_votes:s,negative_votes:i}})}else await l["a"].insert({data:{ratingable_id:this.ratingable.id,ratingable_type_name:this.ratingableTypePlural,positive_votes:"up"===t?1:0,negative_votes:"down"===t?1:0}})}}},p=u,m=s("2877"),h=s("6b1d"),g=s("9c40"),f=s("b047"),b=s("05c0"),y=s("eebe"),v=s.n(y),_=Object(m["a"])(p,i,n,!1,null,null,null);e["a"]=_.exports;v()(_,"components",{QLinearProgress:h["a"],QBtn:g["a"],QChip:f["a"],QTooltip:b["a"]})},db11:function(t,e,s){},e118:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:{error:t.errorMessage}},[s("q-input",{ref:"textField",attrs:{type:"textarea",autogrow:"",outlined:""},on:{input:t.input},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}}),t.errorMessage?s("span",{staticStyle:{color:"red"}},[t._v(t._s(t.errorMessage))]):t._e()],1)},n=[],o=(s("5319"),s("4f9d")),a={name:"PostForm",props:{content:{type:String,required:""},order:{type:Number,required:!0},errorMessage:{type:[String]}},data(){return{model:"",postEditor:new o["a"]}},watch:{model(t){this.postEditor.updateSection(this.order,t)}},created(){this.model=this.replaceBr(this.content)},methods:{input(){this.$emit("input",this.model)},replaceBr(t){return t?t.replace(/<br>/g,""):""}}},r=a,l=s("2877"),c=s("27f9"),d=s("eebe"),u=s.n(d),p=Object(l["a"])(r,i,n,!1,null,null,null);e["a"]=p.exports;u()(p,"components",{QInput:c["a"]})},e600:function(t,e,s){},e7bd:function(t,e,s){"use strict";s("db11")},f01b:function(t,e,s){"use strict";s("8402")},f542:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{staticClass:"q-mt-lg q-mb-lg",staticStyle:{color:"darkslategray"},attrs:{flat:""}},[t.isReply&&!t.isExpanded?s("q-card-actions",{staticClass:"q-ml-sm",on:{click:function(e){t.isOpened=!0}}},[s("q-btn",{attrs:{dense:"","no-caps":"",color:"light-green-8"}},[t._v(t._s(t.$t("to_reply")))])],1):t._e(),t.isExpanded?[s("q-card-section",[s("div",[t._v(t._s(t.isReply?t.$t("to_reply"):t.$t("add_comment")))]),s("q-input",{attrs:{autogrow:"",outlined:"",autofocus:t.isReply,error:!!t.validator.errors.body,"error-message":t.validator.errors.body},on:{focus:t.checkAuth,input:function(e){return t.validator.resetErrors()}},model:{value:t.formModel.body,callback:function(e){t.$set(t.formModel,"body",e)},expression:"formModel.body"}})],1),s("q-separator"),s("q-card-actions",{staticClass:"q-ml-sm"},[s("q-btn",{attrs:{loading:t.isSubmitting,disable:t.isSubmitting,dense:"","no-caps":"",color:"light-green-8"},on:{click:t.submit}},[t._v("\n        "+t._s(t.$t("submit"))+"\n      ")])],1)]:t._e()],2)},n=[],o=s("891a"),a=s("2b16"),r=s("2ef0"),l=s.n(r),c=s("6357"),d=s("72cd"),u=s("09ad");const p={body:null};var m={name:"AddComment",props:{isReply:{type:Boolean,default:!1},commentableId:{type:Number,required:!0},commentableType:{type:String,required:!0},postId:{type:Number,required:!0}},data(){return{formModel:l.a.cloneDeep(p),isOpened:!1,isSubmitting:!1,api:new a["a"],validator:new c["a"](p),scroll:new u["a"]}},computed:{isExpanded(){return!this.isReply||this.isOpened},me(){return o["a"].query().first()}},methods:{checkAuth(){return!!this.me||(this.showUnauthMessage(),!1)},submit(){if(!this.checkAuth())return;this.isSubmitting=!0;const t={post_id:this.postId,commentable_id:this.commentableId,commentable_type:this.commentableType,body:this.formModel.body};this.api.create(t).then((t=>{this.formModel=l.a.cloneDeep(p),d["a"].insert({data:t.data}),this.$q.notify({message:this.$t("success"),position:"center",color:"positive"}),this.isSubmitting=!1,this.isReply&&(this.isOpened=!1),setTimeout((()=>{const e=document.getElementById("comment-"+t.data.id);e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),this.scroll.whenScrollFinished().then((()=>{this.flashComment(t.data.id)}))}),10)})).catch((t=>{this.validator.setErrors(t),this.isSubmitting=!1}))},flashComment(t){const e=document.getElementById("comment-"+t),s=e.getBoundingClientRect(),i=s.top<window.innerHeight&&s.bottom>=0;i&&(e.classList.add("flash"),setTimeout((()=>{e.classList.remove("flash")}),2e3))},showUnauthMessage(){this.$q.notify({message:this.$t("need_to_login_or_register"),position:"center",color:"negative"})}}},h=m,g=s("2877"),f=s("f09f"),b=s("4b7e"),y=s("9c40"),v=s("a370"),_=s("27f9"),w=s("eb85"),q=s("eebe"),I=s.n(q),$=Object(g["a"])(h,i,n,!1,null,null,null);e["a"]=$.exports;I()($,"components",{QCard:f["a"],QCardActions:b["a"],QBtn:y["a"],QCardSection:v["a"],QInput:_["a"],QSeparator:w["a"]})},f724:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("iframe",{attrs:{frameborder:"0",allowfullscreen:"1",width:"100%",height:t.$q.platform.is.mobile?200:400,src:t.src}})},n=[],o={name:"YouTube",props:{videoId:{type:String,required:!0}},data(){return{src:null}},created(){this.src="https://www.youtube.com/embed/"+this.videoId},methods:{updateSrc(t){this.src="https://www.youtube.com/embed/"+t}}},a=o,r=s("2877"),l=Object(r["a"])(a,i,n,!1,null,null,null);e["a"]=l.exports},f9a5:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("q-card",{staticClass:"q-my-md",attrs:{id:"post-id-"+t.post.id,dusk:"post-"+t.post.id,bordered:!t.$q.platform.is.mobile,flat:""}},[s("q-card-section",{staticClass:"q-pb-none"},[s("div",{staticClass:"flex justify-between"},[s("div",[s("author",{attrs:{name:t.post.user.login,avatar:t.post.user.avatar}})],1),s("div")]),t.isPostPage?s("q-item",{staticClass:"q-px-none",attrs:{dusk:"post-"+t.post.id+"-title"}},[s("q-item-section",{staticStyle:{"font-size":"1.2rem"}},[t._v("\n          "+t._s(t.post.title)+"\n        ")])],1):t._e(),t.isPostPage?t._e():s("q-item",{staticClass:"q-px-none",attrs:{dense:"",to:{name:"postPage",params:{id:t.post.id}},dusk:"post-"+t.post.id+"-title"}},[s("q-item-section",{staticStyle:{"font-size":"1.2rem"}},[t._v("\n          "+t._s(t.post.title)+"\n        ")])],1)],1),s("q-card-section",{ref:"postBody",class:{folded:!t.postCache.is_expanded&&!t.isPostPage}},t._l(t.post.content,(function(t){return s("post-"+t.type,{key:"postSection-"+t.order,tag:"component",attrs:{data:t}})})),1),t.postCache.is_expanded||t.isPostPage?t._e():s("q-card-section",{staticClass:"q-pt-none"},[s("div",{staticClass:"expander",on:{click:t.expand}},[t._v("\n        "+t._s(t.$t("expand"))+"\n      ")])]),s("q-card-section",{attrs:{dusk:"post-"+t.post.id+"-info"}},[s("post-info",{attrs:{post:t.post}})],1),t.$q.platform.is.mobile?s("q-separator"):t._e()],1),s("div",{ref:"commentsAnchor"}),t.isPostPage?s("comments",{attrs:{"post-id":t.post.id}}):t._e()],1)},n=[],o=(s("e6cf"),s("ddb0"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{color:"#757575"}},[s("div",{staticClass:"flex cursor-default items-center"},[s("rating",{attrs:{ratingable:t.post,"ratingable-type":"post"}}),s("div",{staticClass:"q-mr-md",attrs:{dusk:"post-"+t.post.id+"-info-views"}},[s("chip-info",{attrs:{label:t.post.views,icon:"visibility",tooltip:t.$t("views")}})],1),s("div",{staticClass:"q-mr-md",attrs:{dusk:"post-"+t.post.id+"-info-comments"}},[s("chip-info",{attrs:{label:t.post.comments,icon:"question_answer",tooltip:t.$t("comments")}},[t.isPostPage?t._e():s("q-item",{staticStyle:{padding:"5px","margin-left":"5px"},attrs:{dense:"",to:{name:"postPage",params:{id:t.post.id,toComments:!0}}}},[s("q-item-section",[s("q-icon",{attrs:{color:"grey-7",name:"launch",size:"sm"}})],1)],1)],1)],1)],1),s("div",{staticClass:"q-mt-md flex",attrs:{dusk:"post-"+t.post.id+"-info-tags"}},t._l(t.post.tags,(function(t,e){return s("tag",{key:"tag"+e,attrs:{item:t}})})),1)])}),a=[],r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-item",{staticClass:"t-wrapper",attrs:{exact:"",to:{name:"search",query:{tids:t.item.id}}}},[t.item.body?s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10],"transition-show":"scale","transition-hide":"scale","max-width":"300px"}},[s("span",{staticStyle:{"font-size":"1rem"}},[t._v(t._s(t.item.body))])]):t._e(),t._v("\n\n  "+t._s(t.item.title)+"\n")],1)},l=[],c={name:"Tag",props:{item:{type:Object,required:!0}}},d=c,u=(s("01a2"),s("2877")),p=s("66e5"),m=s("05c0"),h=s("eebe"),g=s.n(h),f=Object(u["a"])(d,r,l,!1,null,null,null),b=f.exports;g()(f,"components",{QItem:p["a"],QTooltip:m["a"]});var y=s("d171"),v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-chip",{staticStyle:{"padding-left":"25px"},attrs:{color:t.bgColor,size:"1rem"}},[s("q-avatar",[s("q-icon",{attrs:{color:t.iconColor,name:t.icon,size:"1.5rem"}},[t.tooltip?s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10],"transition-show":"scale","transition-hide":"scale"}},[t._v("\n        "+t._s(t.tooltip)+"\n      ")]):t._e()],1)],1),s("span",{staticStyle:{"font-size":"0.9rem"}},[t._v(t._s(t.label))]),t._t("default")],2)},_=[],w={name:"ChipInfo",props:{icon:{type:String,required:!0},label:{type:[String,Number],required:!0},tooltip:{type:String,default:null},bgColor:{type:String,default:"light-blue-1"},iconColor:{type:String,default:"grey-7"}},data(){return{}}},q=w,I=s("b047"),$=s("cb32"),x=s("0016"),S=Object(u["a"])(q,v,_,!1,null,null,null),C=S.exports;g()(S,"components",{QChip:I["a"],QAvatar:$["a"],QIcon:x["a"],QTooltip:m["a"]});var P={name:"PostInfo",components:{ChipInfo:C,Tag:b,Rating:y["a"]},props:{post:{type:Object,required:!0}},data(){return{}},computed:{isPostPage(){return"postPage"===this.$route.name}}},E=P,M=(s("e7bd"),s("4074")),k=Object(u["a"])(E,o,a,!1,null,null,null),T=k.exports;g()(k,"components",{QItem:p["a"],QItemSection:M["a"],QIcon:x["a"]});var Q=s("5e86"),O=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{domProps:{innerHTML:t._s(t.data.body)}})},F=[],A=s("f67e"),j={name:"PostText",props:{data:{type:A["a"],required:!0}}},B=j,z=Object(u["a"])(B,O,F,!1,null,null,null),V=z.exports,W=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{ref:"image",staticClass:"flex justify-center"},[s("img",{staticStyle:{"max-width":"100%"},style:{margin:"10px 0 15px 0",borderRadius:"5px"},attrs:{src:t.imageUrl,alt:"Зображення"}})]),t.data.title?s("div",{staticClass:"q-mb-lg text-center"},[t._v("\n    "+t._s(t.data.title)+"\n  ")]):t._e()])},D=[],R=s("ee7a"),L={name:"PostImage",props:{data:{type:R["a"],required:!0}},data(){return{isImageWiderThanWrapper:null}},computed:{isDesktop(){return this.$q.platform.is.desktop},imageUrl(){const t=this.$q.platform.is.desktop;return t?this.data.desktop_file_path||this.data.original_file_path:this.data.mobile_file_path||this.data.desktop_file_path||this.data.original_file_path},imageWidth(){const t=this.data.imageData;return this.isDesktop?this.data.desktop_file_path?t.desktop.width:t.original.width:this.data.mobile_file_path?t.mobile.width:t.original.width}},mounted(){this.isImageWiderThanWrapper=this.$refs.image.offsetWidth<this.data.width}},H=L,Y=Object(u["a"])(H,W,D,!1,null,null,null),N=Y.exports,U=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{staticClass:"q-mb-xl",attrs:{flat:"",bordered:!t.$q.platform.is.mobile}},[s("q-card-section",[s("add-comment",{attrs:{"commentable-id":t.postId,"commentable-type":"post","post-id":t.postId}}),t.isFetching?s("q-linear-progress",{staticStyle:{"margin-top":"-4px"},attrs:{indeterminate:""}}):t._e(),t.isFetching||t.comments.length?t._e():s("div",{staticClass:"text-center"},[t._v("\n      "+t._s(t.$t("there_are_no_comments_yet"))+"\n    ")]),t._l(t.comments,(function(e,i){return s("comment",{key:e.id,attrs:{comment:e,"post-id":t.postId,level:1,"is-last":t.comments.length-1===i,"post-author":t.postAuthor}})}))],2)],1)},K=[],X=s("67f1"),J=s("2b16"),G=s("72cd"),Z=s("f542"),tt={name:"PostComments",components:{AddComment:Z["a"],Comment:X["default"]},props:{postId:{type:Number,required:!0}},data(){return{temp:"",api:new J["a"],isFetching:!0}},computed:{comments(){return G["a"].query().where((t=>"posts"===t.commentable_type_name&&t.commentable_id===this.postId)).orderBy("id","desc").with("rating").with("user").get()},postAuthor(){return Q["a"].query().with("user").find(this.postId).user}},async created(){const t=await this.api.fetch(this.postId,"post");await G["a"].insert({data:t.data}),this.isFetching=!1},beforeDestroy(){G["a"].deleteAll()}},et=tt,st=s("f09f"),it=s("a370"),nt=s("6b1d"),ot=Object(u["a"])(et,U,K,!1,null,null,null),at=ot.exports;g()(ot,"components",{QCard:st["a"],QCardSection:it["a"],QLinearProgress:nt["a"]});var rt=s("5fb2"),lt=s("26d8"),ct=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("you-tube",{attrs:{"video-id":t.data.youtube_id}})},dt=[],ut=s("f724"),pt=s("dc64"),mt={name:"PostYoutube",components:{YouTube:ut["a"]},props:{data:{type:pt["a"],required:!0}},data(){return{}},created(){console.log(this.data)}},ht=mt,gt=Object(u["a"])(ht,ct,dt,!1,null,null,null),ft=gt.exports,bt={name:"Post",components:{Comments:at,PostImage:N,PostText:V,PostInfo:T,Author:rt["a"],PostYoutube:ft},props:{post:{type:Q["a"],required:!0}},data(){return{isPostPage:!1,cache:new lt["a"],postCache:{is_expanded:!1,is_images_loaded:!1},isHasImages:!1,postId:null}},async created(){this.isHasImages=!!this.post.post_images.length,this.isPostPage="postPage"===this.$route.name,this.postCache=await this.cache.getOrCreateEntityCache("posts",this.post.id)},async mounted(){this.isHasImages||this.postCache.is_expanded||await this.maybeExpandBody("mounted"),this.postCache.is_expanded||!this.isHasImages||this.postCache.is_images_loaded||this.imagesLoadedHandler(),this.isPostPage&&this.$route.params.toComments&&setTimeout((()=>{this.$refs.commentsAnchor.scrollIntoView(),window.scrollBy(0,50)}),10)},methods:{isShortBody(){const t=this.$refs.postBody.$el.scrollHeight,e=.49*window.innerHeight;return t<e},async expand(){this.isExpanded=!0,this.postCache=await this.cache.updateEntityCache("posts",this.post.id,{is_expanded:!0})},async maybeExpandBody(t=!1){const e={is_images_loaded:t};this.isShortBody()&&(e.is_expanded=!0),this.postCache=await this.cache.updateEntityCache("posts",this.post.id,e)},imagesLoadedHandler(){const t=this.$refs.postBody.$el.getElementsByTagName("img");Promise.all(Array.from(t).filter((t=>!t.complete)).map((t=>new Promise((e=>{t.onload=t.onerror=e}))))).then((()=>{setTimeout((()=>{this.maybeExpandBody(!0)}),10)}))}}},yt=bt,vt=(s("f01b"),s("9c40")),_t=s("eb85"),wt=Object(u["a"])(yt,i,n,!1,null,null,null);e["a"]=wt.exports;g()(wt,"components",{QCard:st["a"],QCardSection:it["a"],QBtn:vt["a"],QItem:p["a"],QItemSection:M["a"],QSeparator:_t["a"]})}}]);