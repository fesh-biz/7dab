(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{"0d8b":function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row justify-center q-px-sm"},[s("div",{staticClass:"col-sm-12 col-xs-12 col-md-8 col-lg-6 col-xl-5"},[t.fetching.posts?s("q-linear-progress",{class:{"q-mt-md":!t.$q.platform.is.mobile},attrs:{indeterminate:""}}):t._e(),t._l(t.posts,(function(t,e){return s("post",{key:"post"+e,attrs:{post:t}})})),t.isLastFetched?s("q-banner",{staticClass:"text-center",attrs:{dusk:"main-no-more-posts",rounded:""}},[t._v("\n      "+t._s(t.$t("there_is_no_new_posts"))+"\n    ")]):t._e(),t.fetching.posts&&t.posts.length?s("q-linear-progress",{staticClass:"q-mb-xl",attrs:{dusk:"main-new-posts-loading",indeterminate:""}}):t._e()],2)])},n=[],a=(s("e6cf"),s("5e86")),i=s("f9a5"),c=s("7cbd");function r(t){const e=document.documentElement.offsetHeight,s=window.innerHeight,o=window.scrollY||window.pageYOffset||document.body.scrollTop+(document.documentElement&&document.documentElement.scrollTop||0);return e<=s+o+(t||0)}var l=s("f146"),d={name:"FeedMain",components:{Post:i["a"]},data(){return{fetching:{posts:!1},isLastFetched:!1,currentPage:0,postApi:new c["a"]}},computed:{posts(){return a["a"].query().withAll().orderBy("id","desc").all()}},async created(){this.posts.length<2&&(await a["a"].deleteAll(),this.fetchPosts(!0))},mounted(){window.addEventListener("scroll",this.maybeFetchNextPosts)},methods:{scrollToPost(t){const e=document.getElementById(t);e?setTimeout((()=>{e.scrollIntoView({behavior:"smooth"})}),100):setTimeout((()=>{this.scrollToPost(t)}),100)},maybeFetchNextPosts(){this.fetching.posts||!r(500)||this.isLastFetched||this.fetchPosts()},fetchPosts(t){console.log("fetching"),this.fetching.posts=!0,this.postApi.fetchPosts(++this.currentPage).then((e=>{t?a["a"].create({data:e.data.data}):a["a"].insert({data:e.data.data}),this.isLastFetched=e.data.meta.is_last,this.$nextTick((()=>{this.fetching.posts=!1,l["a"].emitImagesUploaded()}))})).catch((()=>{this.fetching.posts=!1}))}},beforeDestroy(){window.removeEventListener("scroll",this.maybeFetchNextPosts)}},h=d,m=s("2877"),p=s("6b1d"),u=s("54e1"),f=s("eebe"),g=s.n(f),w=Object(m["a"])(h,o,n,!1,null,null,null);e["default"]=w.exports;g()(w,"components",{QLinearProgress:p["a"],QBanner:u["a"]})}}]);