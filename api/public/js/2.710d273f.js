(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"419d":function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"row justify-center q-px-sm"},[o("div",{staticClass:"col-sm-12 col-xs-12 col-md-8 col-lg-6 col-xl-5 q-mt-md"},[o("q-card",{staticClass:"q-my-md",attrs:{flat:t.$q.platform.is.mobile}},[o("q-card-section",[o("q-input",{attrs:{outlined:"",dense:"",label:t.$t("title"),error:!!t.postEditor.validator.errors.title,"error-message":t.postEditor.validator.errors.title},on:{input:function(e){return t.postEditor.validator.resetFieldError("title")}},model:{value:t.postEditor.formModel.title,callback:function(e){t.$set(t.postEditor.formModel,"title",e)},expression:"postEditor.formModel.title"}}),o("div",{staticClass:"ap-body"},t._l(t.postEditor.formModel.sections,(function(e,s){return o("div",{key:"body-element"+e.order,staticClass:"q-mb-md"},[o("div",[o("icon-with-tooltip",{attrs:{tooltip:t.$t("delete_section"),icon:"delete"},on:{click:function(e){return t.postEditor.deleteSection(s)}}})],1),o(e.type+"-field",{ref:"editor["+e.order+"]",refInFor:!0,tag:"component",attrs:{content:e.content,order:e.order,"error-message":t.getSectionError(e.order)},on:{input:function(o){return t.postEditor.validator.resetFieldError("sections",e.order)}}})],1)})),0),o("tag-field",{attrs:{"error-message":t.tagError},on:{input:t.updatePostTags}})],1),o("q-card-section",{staticClass:"flex justify-between"},[o("q-inner-loading",{attrs:{showing:t.isBusy,color:"positive"}}),o("div",{staticClass:"inline-block"},[o("icon-with-tooltip",{attrs:{tooltip:t.$t("add_text"),color:"positive",disabled:t.isBusy,size:"xl",icon:"notes"},on:{click:function(e){return t.postEditor.addSection("text")}}}),o("icon-with-tooltip",{attrs:{tooltip:t.$t("add_image"),color:"positive",disabled:t.isBusy,size:"xl",icon:"image"},on:{click:function(e){return t.postEditor.addSection("image")}}})],1),o("div",{staticClass:"inline-block"},[o("icon-with-tooltip",{attrs:{tooltip:t.$t("cancel"),color:"negative",disabled:t.isBusy,size:"xl",icon:"cancel"}}),o("icon-with-tooltip",{attrs:{tooltip:t.$t("save"),color:"positive",disabled:t.isBusy,size:"xl",icon:"check_circle"},on:{click:function(e){return t.saveOrUpdate()}}})],1)],1)],1)],1)])},i=[],r=(o("e6cf"),function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"wrapper",staticClass:"flex justify-center",class:{error:t.errorMessage}},[t.isImageAdded||t.content&&t.content.url?o("div",{staticStyle:{width:"100%"}},[o("icon-with-tooltip",{staticClass:"cursor-pointer",attrs:{size:"2rem",icon:"change_circle",tooltip:t.$t("change_image")},on:{click:t.addImages}})],1):t._e(),t.isImageAdded?t._e():o("q-icon",{staticClass:"cursor-pointer",staticStyle:{"background-color":"white"},attrs:{size:"10rem",color:"blue-grey-2",name:"add_a_photo"},on:{click:t.addImages}}),o("canvas",{ref:"canvas",attrs:{width:this.wrapperWidth,height:"0"}}),o("q-input",{staticStyle:{width:"100%"},attrs:{dense:"",label:t.$t("add_image_label"),"stack-label":""},on:{input:t.input},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t.errorMessage?o("span",{staticStyle:{color:"red",width:"100%"}},[t._v(t._s(t.errorMessage))]):t._e()],1)}),n=[],a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-icon",{staticClass:"cursor-pointer",class:{"iwt-disabled":this.disabled},attrs:{name:t.icon,color:t.color,size:t.size},on:{click:t.click}},[o("q-tooltip",{attrs:{"transition-show":"scale","transition-hide":"scale",self:"bottom middle",anchor:"top middle"}},[t._v("\n    "+t._s(t.tooltip)+"\n  ")])],1)},l=[],c={name:"IconWithToolTip",props:{icon:{type:String,required:!0},tooltip:{type:String,required:!0},color:{type:String,default:""},size:{type:String,default:"md"},disabled:{type:Boolean,default:!1}},data(){return{}},methods:{click(){this.disabled||this.$emit("click")}}},d=c,p=(o("8643"),o("2877")),u=o("0016"),h=o("05c0"),m=o("eebe"),f=o.n(m),g=Object(p["a"])(d,a,l,!1,null,null,null),v=g.exports;f()(g,"components",{QIcon:u["a"],QTooltip:h["a"]});var w=o("6357"),y=o("7cbd"),E=o("2ef0"),b=o.n(E),_=o("5e86");const $={title:"",sections:[],tags:[]};class I{constructor(){if(I.instance)return I.instance;this.formModel=b.a.cloneDeep($),this.api=new y["a"],this.validator=new w["a"]($),I.instance=this}addSection(t,e,o){const s=this.formModel.sections.length?this.formModel.sections[this.formModel.sections.length-1].order+1:1;this.formModel.sections.push({id:o,order:s,type:t,content:e||null})}addSections(t,e,o){o.forEach((e=>{e instanceof File&&this.addSection(t,{file:e})}))}deleteSection(t){const e=this.formModel.sections[t];this.formModel.sections.splice(t,1),this.validator.resetFieldError("sections",e.order)}fillFormModel(t){this.formModel=b.a.cloneDeep($);const e=_["a"].query().withAll().find(t);console.log("post",e),this.formModel.title=e.title,e.content.forEach((t=>{"text"===t.type&&this.addSection("text",t.body,t.id),"image"===t.type&&this.addSection("image",{url:t.original_file_path,title:t.title},t.id)}));const o=[];e.tags.forEach((t=>{o.push({label:t.title,value:t.id})})),this.formModel.tags=o}updateSection(t,e){const o=b.a.find(this.formModel.sections,{order:t});"text"!==o.type?"image"===o.type&&(o.content=o.content||{file:null,url:null,title:null},o.content=Object.assign(o.content,e)):o.content=e}resetFormModel(){this.formModel=b.a.cloneDeep($)}getFormData(){const t=this.formModel,e=new FormData;e.append("title",t.title);for(let o=0;o<t.sections.length;o++){const s=t.sections[o];if(s.id&&e.append(`sections[${o}][id]`,s.id),e.append(`sections[${o}][type]`,s.type),e.append(`sections[${o}][order]`,s.order),"image"===s.type){if(!s.content)continue;s.content.file&&e.append(`sections[${o}][content][file]`,s.content.file),e.append(`sections[${o}][content][url]`,s.content.url||""),e.append(`sections[${o}][content][title]`,s.content.title||"")}"text"===s.type&&e.append(`sections[${o}][content]`,s.content||"")}for(let o=0;o<t.tags.length;o++){const s=t.tags[o];s.value?e.append(`tags[${o}][id]`,s.value):e.append(`tags[${o}][new]`,s)}return e}saveOrUpdate(t){return new Promise(((e,o)=>{const s=this.getFormData(),i=t?"update":"store";this.api[i](s,t).then((t=>e(t))).catch((t=>{this.validator.setErrors(t),o(t)}))}))}}var S={name:"ImageField",components:{IconWithTooltip:v},props:{content:{type:Object,default:null},order:{type:Number,required:!0},errorMessage:{type:[String]}},data(){return{wrapperWidth:0,isImageAdded:!1,postEditor:new I}},computed:{title:{get(){var t;return(null===(t=this.content)||void 0===t?void 0:t.title)||""},set(t){this.postEditor.updateSection(this.order,{title:t})}}},async mounted(){this.wrapperWidth=this.$refs.wrapper.offsetWidth,this.content?this.content.file?this.drawImage(this.content.file):this.content.url&&this.drawImageFromUrl(this.content.url):this.addImages()},methods:{input(){this.$emit("input")},addImages(){this.$emit("input");const t=document.createElement("input");t.type="file",t.multiple=!0,t.onchange=t=>{this.handleImages(t.target.files)},t.click()},drawImage(t){const e=this.$refs.canvas,o=e.getContext("2d"),s=new FileReader;s.onload=t=>{const s=new Image;s.onload=()=>{let t=s.width,i=s.height;t>this.wrapperWidth&&(i*=this.wrapperWidth/t,t=this.wrapperWidth),e.width=t,e.height=i,o.drawImage(s,0,0,s.width,s.height,0,0,t,i),this.isImageAdded=!0},s.src=t.target.result},s.readAsDataURL(t)},async drawImageFromUrl(t){const e=await fetch(t),o=await e.blob(),s={type:"image/jpeg"};let i=t;i=i.substr(i.lastIndexOf("/")+1);const r=new File([o],i,s);this.drawImage(r)},handleImages(t){const e=this.validateImages(t);if(e)return void this.$q.notify({message:e,position:"center",color:"negative"});const o=t[0];this.drawImage(o),this.postEditor.updateSection(this.order,{file:o});const s=[];for(let i=0;i<t.length;i++)i>0&&s.push(t[i]);this.postEditor.addSections("image",this.order,s)},validateImages(t){let e=null;const o=/(jpg)|(png)|(jpeg)/i;for(let s=0;s<t.length;s++){o.test(t[s].type)||(e=this.$t("wrong_image_file_allowed_types")+": jpg, jpeg, png");const i=5e3;if(t[s].size>1024*i&&(e=this.$t("max_allowed_filesize")+" "+i+"Kb"),e)break}return e}}},M=S,x=o("27f9"),q=Object(p["a"])(M,r,n,!1,null,null,null),k=q.exports;f()(q,"components",{QIcon:u["a"],QInput:x["a"]});var F=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{class:{error:t.errorMessage}},[o("q-input",{ref:"textField",attrs:{type:"textarea",autogrow:"",outlined:""},on:{input:t.input},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}}),t.errorMessage?o("span",{staticStyle:{color:"red"}},[t._v(t._s(t.errorMessage))]):t._e()],1)},C=[],P=(o("5319"),{name:"PostForm",props:{content:{type:String,required:""},order:{type:Number,required:!0},errorMessage:{type:[String]}},data(){return{model:"",postEditor:new I}},watch:{model(t){this.postEditor.updateSection(this.order,t)}},created(){this.model=this.replaceBr(this.content)},methods:{input(){this.$emit("input",this.model)},replaceBr(t){return t?t.replace(/<br>/g,""):""}}}),j=P,T=Object(p["a"])(j,F,C,!1,null,null,null),B=T.exports;f()(T,"components",{QInput:x["a"]});var O=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{class:{error:t.errorMessage}},[o("q-select",{attrs:{label:t.$t("tags"),options:t.options,"use-input":"","use-chips":"",multiple:"","option-disable":"inactive","hide-dropdown-icon":"",outlined:"","input-debounce":"300","new-value-mode":"add-unique"},on:{input:function(e){return t.$emit("input",t.model)},filter:t.filterFn},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}}),t.errorMessage?o("span",{staticStyle:{color:"red"}},[t._v(t._s(t.errorMessage))]):t._e()],1)},z=[],A=o("77fc");class Q{constructor(){if(Q.instance)return Q.instance;this.api=new A["a"],Q.instance=this}search(t){return new Promise(((e,o)=>{this.api.get(`/tags/search?title=${t}`).then((t=>e(t))).catch((t=>o(t)))}))}}var W={name:"TagField",props:{errorMessage:{type:String,default:null},tags:{type:Array,default:null}},data(){return{options:[],tagApi:new Q,postEditor:new I,fetching:!1}},computed:{model:{get(){return this.postEditor.formModel.tags},set(t){this.postEditor.formModel.tags=t}}},created(){console.log("this.postEditor",this.postEditor)},methods:{filterFn(t,e){if(""===t)return void e((()=>{}));const o=t.toLowerCase();this.options=[],this.tagApi.search(o).then((t=>{const o=t.data.data,s=[];o.forEach((t=>{s.push({label:t.title,value:t.id,inactive:"rejected"===t.status})})),e((()=>{this.options=s}))}))}}},D=W,U=o("ddd8"),L=Object(p["a"])(D,O,z,!1,null,null,null),N=L.exports;f()(L,"components",{QSelect:U["a"]});var R=o("a31e"),J={name:"AddPost",components:{TooltipIcon:R["a"],ImageField:k,TextField:B,IconWithTooltip:v,TagField:N},data(){return{postEditor:new I,postApi:new y["a"],isBusy:!1}},computed:{sectionsErrors(){return this.postEditor.validator.errors.sections},isEditing(){return"editPost"===this.$route.name},postId(){return this.$route.params.id},post(){return _["a"].query().withAll().find(this.postId)},tagError(){return this.postEditor.validator.errors.tags||null}},created(){this.isEditing&&!this.post&&this.fetchPost().then((t=>{_["a"].insert({data:t.data.data}),this.postEditor.fillFormModel(this.postId),console.log("this.postEditor",this.postEditor)})),this.isEditing||this.postEditor.addSection("text")},beforeDestroy(){this.postEditor.resetFormModel()},methods:{fetchPost(){return new Promise(((t,e)=>{this.isBusy=!0,this.postApi.fetchPost(this.postId).then((e=>{this.isBusy=!1,t(e)})).catch((()=>{this.isBusy=!1}))}))},getSectionError(t){const e=this.postEditor.validator.errors.sections;return e?"string"===typeof e?this.$t("all_fields_must_be_filled"):e[t]:null},saveOrUpdate(){this.isBusy=!0,this.postEditor.saveOrUpdate(this.postId).then((t=>{this.isBusy=!1;const e=t.data.data,o=e.id;this.isEditing||(_["a"].create({data:t.data.data}),this.$router.push({name:"editPost",params:{id:o}}))})).catch((()=>{this.isBusy=!1}))},updatePostTags(t){this.postEditor.validator.errors.tags=null},crtlSHandler(t){document.addEventListener("keydown",(t=>{t.ctrlKey&&"s"===t.key&&(t.preventDefault(),console.log("CTRL + S"))}))}}},K=J,H=o("f09f"),G=o("a370"),V=o("74f7"),X=Object(p["a"])(K,s,i,!1,null,null,null);e["default"]=X.exports;f()(X,"components",{QCard:H["a"],QCardSection:G["a"],QInput:x["a"],QInnerLoading:V["a"]})},6357:function(t,e,o){"use strict";o.d(e,"a",(function(){return i}));var s=o("8847");class i{constructor(t){this.formModel=t,this.errors={error_message:null},this.formModel&&this.resetErrors()}setError(t,e){this.errors[t]=e[t]?e[t][0]:null}setErrors(t){const e=t.response.data.errors;if(e){for(const o in e)if(e.hasOwnProperty(o)){if("error_message"===o){this.errors.error_message=e[o];continue}this.errors[o]=e[o][0]||e[o]}}else{const e={invalid_grant:s["b"].messages[s["b"].locale].wrong_credentials,invalid_request:s["b"].messages[s["b"].locale].check_your_data},o=t.response.data.error;this.errors.error_message=e[o]||null}}resetFieldError(t,e){this.errors[t]&&(e?"string"===typeof this.errors[t]?this.errors[t]=null:this.errors[t][e]=null:this.errors[t]=null),this.errors.error_message=null}resetErrors(){for(const t in this.formModel)this.formModel.hasOwnProperty(t)&&(this.errors[t]=null)}}},"7cbd":function(t,e,o){"use strict";o.d(e,"a",(function(){return i}));o("e6cf");var s=o("77fc");class i{constructor(){if(i.instance)return i.instance;this.api=new s["a"],i.instance=this}fetchPost(t){return new Promise(((e,o)=>{this.api.get(`content/posts/${t}`).then((t=>{e(t)})).catch((t=>{o(t)}))}))}fetchPosts(t){return new Promise(((e,o)=>{this.api.get(`/content/posts?page=${t}`).then((t=>{e(t)})).catch((t=>{o(t)}))}))}store(t){return new Promise(((e,o)=>{this.api.post("/content/posts",t,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>e(t))).catch((t=>{o(t)}))}))}update(t,e){return new Promise(((o,s)=>{this.api.put(`/content/posts/${e}`,t,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>o(t))).catch((t=>{s(t)}))}))}}},8643:function(t,e,o){"use strict";o("e600")},a31e:function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10],"transition-show":"scale","transition-hide":"scale"}},[t._v("\n    "+t._s(t.tooltip)+"\n  ")]),o("q-icon",{staticClass:"q-mr-xs",attrs:{size:t.iconSize,name:t.iconName},on:{click:function(e){return t.$emit("click")}}})],1)},i=[],r={name:"TooltipIcon",props:{tooltip:{type:String,required:!0},iconName:{type:String,required:!0},iconSize:{type:String,default:"sm"}},data(){return{}}},n=r,a=o("2877"),l=o("05c0"),c=o("0016"),d=o("eebe"),p=o.n(d),u=Object(a["a"])(n,s,i,!1,null,null,null);e["a"]=u.exports;p()(u,"components",{QTooltip:l["a"],QIcon:c["a"]})},e600:function(t,e,o){}}]);