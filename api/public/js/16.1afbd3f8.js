(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{"8acd":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("q-card",{attrs:{flat:"",bordered:""}},[s("q-card-section",[s("div",{staticClass:"text-h6"},[e._v(e._s(e.$t("search")))])]),s("q-card-section",[s("q-input",{staticClass:"q-mb-lg",attrs:{outlined:"",label:e.$t("word_or_phrase")},model:{value:e.formModel.keyword,callback:function(t){e.$set(e.formModel,"keyword",t)},expression:"formModel.keyword"}}),e.isFetchingTags?s("q-linear-progress",{staticStyle:{position:"relative",top:"4px"},attrs:{indeterminate:""}}):e._e(),s("tag-field",{attrs:{"tag-ids":e.tagIds},model:{value:e.formModel.tags,callback:function(t){e.$set(e.formModel,"tags",t)},expression:"formModel.tags"}})],1),s("q-card-actions",{staticClass:"q-pa-md"},[s("q-btn",{attrs:{color:"positive","no-caps":"",label:e.$t("search")},on:{click:e.changeURI}})],1),e.isFetchingSearchResult?s("q-linear-progress",{attrs:{indeterminate:""}}):e._e(),e.hasFormModelVars?e._e():s("q-card-section",[e._v("\n      "+e._s(e.$t("fill_form"))+"\n    ")]),!e.hasFormModelVars||e.isFetchingSearchResult||e.posts.length?e._e():s("q-card-section",[e._v("\n      "+e._s(e.$t("no_posts_for_request"))+"\n    ")])],1),e.posts.length?[e._l(e.posts,(function(e,t){return s("post",{key:"post"+t,attrs:{post:e}})})),e.isLast?s("q-banner",{staticClass:"text-center",attrs:{dusk:"main-no-more-posts",rounded:""}},[e._v("\n      "+e._s(e.$t("there_is_no_new_posts"))+"\n    ")]):e._e(),e.isFetchingSearchResult&&e.posts.length?s("q-linear-progress",{staticClass:"q-mb-xl",attrs:{dusk:"main-new-posts-loading",indeterminate:""}}):e._e()]:e._e()],2)},a=[],r=(s("e6cf"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-select",{ref:"tagField",attrs:{label:e.$t("tags"),options:e.options,"use-input":"","use-chips":"",multiple:"","option-disable":"inactive","hide-dropdown-icon":"",outlined:"","input-debounce":"500","new-value-mode":"add-unique"},on:{filter:e.filter,"input-value":function(t){return e.inputValue=t}},nativeOn:{keydown:function(t){return e.onKeyDown(t)}},model:{value:e.model,callback:function(t){e.model=t},expression:"model"}})}),o=[],n=s("89d6"),l=s("d8a1"),c={name:"TagField",props:{value:{type:Array,required:!1},filterLimit:{type:Number,default:5}},data(){return{isFetching:!1,options:[],api:new n["a"],inputValue:null,isFiltering:!1,commaTimeout:null}},computed:{model:{get(){return this.value},set(e){this.$emit("input",e)}}},methods:{getTagOptions(e){const t=[];return e.forEach((e=>{t.push({label:e.title,value:e.id,inactive:"rejected"===e.status})})),t},onKeyDown(e){"search"!==this.$route.name&&(","===e.key||","===e.key&&e.shiftKey)&&(e.preventDefault(),this.$refs.tagField.add(this.inputValue),this.$refs.tagField.updateInputValue(""))},filter(e,t){if(this.options=[],""===e)return void t((()=>{}));const s=e.toLowerCase(),i=l["a"].query().where((e=>e.title.toLowerCase().includes(s))).get();i.length!==this.filterLimit?(this.isFiltering=!0,this.api.search(s,this.filterLimit).then((e=>{const s=e.data;l["a"].insert({data:s}),this.isFiltering=!1,t((()=>{this.options=this.getTagOptions(s)}))}))):t((()=>{this.options=this.getTagOptions(i)}))}}},h=c,d=s("2877"),u=s("ddd8"),p=s("eebe"),m=s.n(p),g=Object(d["a"])(h,r,o,!1,null,null,null),f=g.exports;m()(g,"components",{QSelect:u["a"]});var w=s("2ef0"),v=s.n(w),y=s("77fc");class q{constructor(){if(q.instance)return q.instance;this.api=new y["a"],q.instance=this}search(e,t){return new Promise(((s,i)=>{this.api.get("content/search",e,t).then((e=>s(e))).catch((e=>i(e)))}))}}var F=s("5e86"),_=s("f9a5"),b=s("26d8"),k=s("09ad");const M={tags:[],keyword:""};var $={name:"Search",components:{TagField:f,post:_["a"]},data(){return{formModel:v.a.cloneDeep(M),tagIds:[],tagApi:new n["a"],isFetchingTags:!1,isFetchingSearchResult:!1,isPrevRequestSuccess:!0,api:new q,cache:new b["a"],posts:[],prevRequestParams:null,scroll:new k["a"],isLast:!1}},watch:{$route(){this.posts=[],this.fillForm().then((()=>{this.search()})),this.$nextTick((()=>{window.scrollTo(0,0)}))}},async created(){await this.fillForm(),this.hasFormModelVars()&&this.search()},mounted(){window.addEventListener("scroll",this.maybeSearch)},methods:{async maybeSearch(){const e=await this.cache.getPagination("posts");this.isLast=e.is_last,this.isFetchingSearchResult||!this.scroll.isScrollBottom(500)||this.isLast||await this.search(e.page)},hasFormModelVars(){return!!this.formModel.keyword||!!this.formModel.tags.length},queryVarsFromFormModel(){const e={};this.formModel.keyword&&(e.kw=this.formModel.keyword);const t=this.formModel.tags;return t.length&&(e.tids=[],t.forEach((t=>{e.tids.push(t.value)}))),e},search(e){if(!this.hasFormModelVars())return;if(!e&&this.cache.hasCacheForCurrentPage("posts"))return void(this.posts=this.getPosts());if(!this.isPrevRequestSuccess)return;this.isFetchingSearchResult=!0,this.isPrevRequestSuccess=!1;const t=this.queryVarsFromFormModel();this.prevRequestParams=t,e&&(t.page=e),this.api.search(t,"posts").then((e=>{const t=e.data.data;F["a"].insert({data:t}),this.posts=this.getPosts(),this.isFetchingSearchResult=!1,this.isPrevRequestSuccess=!0}))},getPosts(){const e=this.cache.getCurrentPageCacheIds("posts");return F["a"].query().withAll().whereIdIn(e).orderBy("id","desc").get()},fillForm(){return new Promise((e=>{this.formModel=v.a.cloneDeep(M);const t=()=>{const e=()=>{let e=null;const t=this.$route.query.tids;return t&&(e="object"===typeof t?t.map((e=>parseInt(e))):[parseInt(t)]),e},t=()=>this.$route.query.kw||null;return{kw:t(),tids:e()}},s=t();this.formModel.keyword=s.kw;const i=e=>{e.forEach((e=>{"rejected"!==e.status&&this.formModel.tags.push({label:e.title,value:e.id})}))};if(!s.tids)return void e();const a=this.cache.getCurrentPageCacheIds("tags",s.tids);if(a.length){const t=l["a"].query().whereIdIn(a).get();return i(t),void e()}this.isFetchingTags=!0,this.tagApi.fetchByIds(s.tids).then((async t=>{const s=t.data;await l["a"].insert({data:s}),i(s),this.isFetchingTags=!1,e()}))}))},changeURI(){if(!this.hasFormModelVars)return void this.$q.notify({message:this.$t("empty_form"),position:"center",color:"negative"});const e=this.queryVarsFromFormModel();v.a.isEqual(this.prevRequestParams,e)||this.$router.push({name:"search",query:e})}},beforeDestroy(){window.removeEventListener("scroll",this.maybeSearch)}},S=$,P=s("f09f"),C=s("a370"),R=s("27f9"),I=s("6b1d"),V=s("4b7e"),L=s("9c40"),T=s("54e1"),x=Object(d["a"])(S,i,a,!1,null,null,null);t["default"]=x.exports;m()(x,"components",{QCard:P["a"],QCardSection:C["a"],QInput:R["a"],QLinearProgress:I["a"],QCardActions:V["a"],QBtn:L["a"],QBanner:T["a"]})}}]);