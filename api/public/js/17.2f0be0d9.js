(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{"8acd":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("q-card",{attrs:{flat:"",bordered:""}},[s("q-card-section",[s("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("search")))])]),s("q-card-section",[s("q-input",{staticClass:"q-mb-lg",attrs:{outlined:"",label:t.$t("word_or_phrase")},model:{value:t.formModel.keyword,callback:function(e){t.$set(t.formModel,"keyword",e)},expression:"formModel.keyword"}}),t.isFetchingTags?s("q-linear-progress",{staticStyle:{position:"relative",top:"4px"},attrs:{indeterminate:""}}):t._e(),s("tag-field",{attrs:{"tag-ids":t.tagIds},model:{value:t.formModel.tags,callback:function(e){t.$set(t.formModel,"tags",e)},expression:"formModel.tags"}})],1),s("q-card-actions",{staticClass:"q-pa-md"},[s("q-btn",{attrs:{color:"positive","no-caps":"",label:t.$t("search")},on:{click:t.changeURI}})],1),t.isFetchingSearchResult?s("q-linear-progress",{attrs:{indeterminate:""}}):t._e(),t.hasFormModelVars?t._e():s("q-card-section",[t._v("\n      "+t._s(t.$t("fill_form"))+"\n    ")]),!t.hasFormModelVars||t.isFetchingSearchResult||t.posts.length?t._e():s("q-card-section",[t._v("\n      "+t._s(t.$t("no_posts_for_request"))+"\n    ")])],1),t.posts.length?[t._l(t.posts,(function(t,e){return s("post",{key:"post"+e,attrs:{post:t}})})),t.isLast?s("q-banner",{staticClass:"text-center",attrs:{dusk:"main-no-more-posts",rounded:""}},[t._v("\n      "+t._s(t.$t("there_is_no_new_posts"))+"\n    ")]):t._e(),t.isFetchingSearchResult&&t.posts.length?s("q-linear-progress",{staticClass:"q-mb-xl",attrs:{dusk:"main-new-posts-loading",indeterminate:""}}):t._e()]:t._e()],2)},i=[],r=(s("e6cf"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-select",{ref:"tagField",attrs:{label:t.$t("tags"),options:t.options,"use-input":"","use-chips":"",multiple:"","option-disable":"inactive","hide-dropdown-icon":"",outlined:"","input-debounce":"500","new-value-mode":"add-unique"},on:{filter:t.filter,"input-value":function(e){return t.inputValue=e}},nativeOn:{keydown:function(e){return t.onKeyDown(e)}},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}})}),o=[],n=s("89d6"),l=s("d8a1"),c={name:"TagField",props:{value:{type:Array,required:!1},filterLimit:{type:Number,default:5}},data(){return{isFetching:!1,options:[],api:new n["a"],inputValue:null,isFiltering:!1,commaTimeout:null}},computed:{model:{get(){return this.value},set(t){this.$emit("input",t)}}},methods:{getTagOptions(t){const e=[];return t.forEach((t=>{e.push({label:t.title,value:t.id,inactive:"rejected"===t.status})})),e},onKeyDown(t){"search"!==this.$route.name&&(","===t.key||","===t.key&&t.shiftKey)&&(t.preventDefault(),this.$refs.tagField.add(this.inputValue),this.$refs.tagField.updateInputValue(""))},filter(t,e){if(this.options=[],""===t)return void e((()=>{}));const s=t.toLowerCase(),a=l["a"].query().where((t=>t.title.toLowerCase().includes(s))).get();a.length!==this.filterLimit?(this.isFiltering=!0,this.api.search(s,this.filterLimit).then((t=>{const s=t.data.data;l["a"].insert({data:t.data.data}),this.isFiltering=!1,e((()=>{this.options=this.getTagOptions(s)}))}))):e((()=>{this.options=this.getTagOptions(a)}))}}},h=c,d=s("2877"),u=s("ddd8"),p=s("eebe"),m=s.n(p),g=Object(d["a"])(h,r,o,!1,null,null,null),f=g.exports;m()(g,"components",{QSelect:u["a"]});var w=s("2ef0"),v=s.n(w),y=s("77fc");class q{constructor(){if(q.instance)return q.instance;this.api=new y["a"],q.instance=this}search(t,e){return new Promise(((s,a)=>{this.api.get("content/search",t,e).then((t=>s(t))).catch((t=>a(t)))}))}}var F=s("5e86"),_=s("f9a5"),b=s("26d8"),k=s("09ad");const M={tags:[],keyword:""};var $={name:"Search",components:{TagField:f,post:_["a"]},data(){return{formModel:v.a.cloneDeep(M),tagIds:[],tagApi:new n["a"],isFetchingTags:!1,isFetchingSearchResult:!1,isPrevRequestSuccess:!0,api:new q,cache:new b["a"],posts:[],prevRequestParams:null,scroll:new k["a"],isLast:!1}},watch:{$route(){this.posts=[],this.fillForm().then((()=>{this.search()})),this.$nextTick((()=>{window.scrollTo(0,0)}))}},async created(){await this.fillForm(),this.hasFormModelVars()&&this.search()},mounted(){window.addEventListener("scroll",this.maybeSearch)},methods:{async maybeSearch(){const t=await this.cache.getPagination("posts");this.isLast=t.is_last,this.isFetchingSearchResult||!this.scroll.isScrollBottom(500)||this.isLast||await this.search(t.page)},hasFormModelVars(){return!!this.formModel.keyword||!!this.formModel.tags.length},queryVarsFromFormModel(){const t={};this.formModel.keyword&&(t.kw=this.formModel.keyword);const e=this.formModel.tags;return e.length&&(t.tids=[],e.forEach((e=>{t.tids.push(e.value)}))),t},search(t){if(!this.hasFormModelVars())return;if(!t&&this.cache.hasCacheForCurrentPage("posts"))return void(this.posts=this.getPosts());if(!this.isPrevRequestSuccess)return;this.isFetchingSearchResult=!0,this.isPrevRequestSuccess=!1;const e=this.queryVarsFromFormModel();this.prevRequestParams=e,t&&(e.page=t),this.api.search(e,"posts").then((t=>{const e=t.data.data;F["a"].insert({data:e}),this.posts=this.getPosts(),this.isFetchingSearchResult=!1,this.isPrevRequestSuccess=!0}))},getPosts(){const t=this.cache.getCurrentPageCacheIds("posts");return F["a"].query().withAll().whereIdIn(t).orderBy("id","desc").get()},fillForm(){return new Promise((t=>{this.formModel=v.a.cloneDeep(M);const e=()=>{const t=()=>{let t=null;const e=this.$route.query.tids;return e&&(t="object"===typeof e?e.map((t=>parseInt(t))):[parseInt(e)]),t},e=()=>this.$route.query.kw||null;return{kw:e(),tids:t()}},s=e();this.formModel.keyword=s.kw;const a=t=>{t.forEach((t=>{"rejected"!==t.status&&this.formModel.tags.push({label:t.title,value:t.id})}))};if(!s.tids)return void t();const i=this.cache.getCurrentPageCacheIds("tags",s.tids);if(i.length){const e=l["a"].query().whereIdIn(i).get();return a(e),void t()}this.isFetchingTags=!0,this.tagApi.fetchByIds(s.tids).then((async e=>{const s=e.data;await l["a"].insert({data:s}),a(s),this.isFetchingTags=!1,t()}))}))},changeURI(){if(!this.hasFormModelVars)return void this.$q.notify({message:this.$t("empty_form"),position:"center",color:"negative"});const t=this.queryVarsFromFormModel();v.a.isEqual(this.prevRequestParams,t)||this.$router.push({name:"search",query:t})}},beforeDestroy(){window.removeEventListener("scroll",this.maybeSearch)}},S=$,P=s("f09f"),C=s("a370"),R=s("27f9"),I=s("6b1d"),V=s("4b7e"),L=s("9c40"),T=s("54e1"),x=Object(d["a"])(S,a,i,!1,null,null,null);e["default"]=x.exports;m()(x,"components",{QCard:P["a"],QCardSection:C["a"],QInput:R["a"],QLinearProgress:I["a"],QCardActions:V["a"],QBtn:L["a"],QBanner:T["a"]})}}]);