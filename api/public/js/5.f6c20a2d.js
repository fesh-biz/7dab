(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"049d":function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.isFetching?s("q-linear-progress",{class:{"q-mt-md":!t.$q.platform.is.mobile},attrs:{indeterminate:""}}):t._e(),t.isFetching?t._e():s("post",{attrs:{post:t.post,isPostView:""}}),s("div",{ref:"commentsStart"}),t.post?s("comments",{attrs:{"post-id":t.post.id}}):t._e()],1)},n=[],i=(s("e6cf"),s("f9a5")),a=s("7cbd"),r=s("26d8"),c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{staticClass:"q-mb-xl",attrs:{flat:"",bordered:!t.$q.platform.is.mobile}},[s("q-card-section",[s("add-comment",{attrs:{"commentable-id":t.postId,"commentable-type":"post","post-id":t.postId}}),t.isFetching?s("q-linear-progress",{staticStyle:{"margin-top":"-4px"},attrs:{indeterminate:""}}):t._e(),t.isFetching||t.comments.length?t._e():s("div",{staticClass:"text-center"},[t._v("\n      "+t._s(t.$t("there_are_no_comments_yet"))+"\n    ")]),t._l(t.comments,(function(e,o){return s("comment",{key:e.id,attrs:{comment:e,"post-id":t.postId,level:1,"is-last":t.comments.length-1===o,"post-author":t.postAuthor}})}))],2)],1)},m=[],l=s("67f1"),d=s("2b16"),u=s("72cd"),h=s("5e86"),p=s("f542"),f=s("09ad"),b={name:"PostComments",components:{AddComment:p["a"],Comment:l["default"]},props:{postId:{type:Number,required:!0}},data(){return{temp:"",api:new d["a"],isFetching:!0,scroll:new f["a"]}},computed:{comments(){return u["a"].query().where((t=>"posts"===t.commentable_type_name&&t.commentable_id===this.postId)).orderBy("id","desc").with("rating").with("user").get()},postAuthor(){return h["a"].query().with("user").find(this.postId).user}},async created(){const t=await this.api.fetchPostComments(this.postId);await u["a"].insert({data:t.data}),this.isFetching=!1;const e=this.$route.query.c;e&&this.$nextTick((()=>{const t=document.getElementById("comment-"+e);t&&(t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),this.scroll.whenScrollFinished().then((()=>{this.flashComment(e)})))}))},methods:{flashComment(t){const e=document.getElementById("comment-"+t),s=e.getBoundingClientRect(),o=s.top<window.innerHeight&&s.bottom>=0;o&&(e.classList.add("flash"),setTimeout((()=>{e.classList.remove("flash")}),2e3))}},beforeDestroy(){u["a"].deleteAll()}},y=b,g=s("2877"),w=s("f09f"),_=s("a370"),v=s("6b1d"),q=s("eebe"),I=s.n(q),C=Object(g["a"])(y,c,m,!1,null,null,null),$=C.exports;I()(C,"components",{QCard:w["a"],QCardSection:_["a"],QLinearProgress:v["a"]});var k={name:"PostView",components:{Post:i["a"],Comments:$},data(){return{isFetching:!0,postApi:new a["a"],post:null,postId:null,cache:new r["a"],isReady:!1}},async created(){this.postId=this.$route.params.id,this.post=h["a"].query().withAll().find(this.postId),this.post?(window.document.title=this.post.title+` - ${this.$t("terevenky")}`,this.cache.getEntityCache("posts",this.postId)||await this.cache.insertEntityCache("posts",this.postId),this.isFetching=!1,this.maybeScrollBottom(),await this.postApi.incrementPostViewsCounter(this.postId)):await this.fetchPost()},methods:{maybeScrollBottom(){const t=this.$route.query.c;(this.$route.params.toComments||t)&&this.$nextTick((()=>{setTimeout((()=>{const t=this.$refs.commentsStart;t.scrollIntoView(),window.scrollBy(0,50)}),10)}))},async fetchPost(){this.postApi.fetchPostView(this.postId).then((async t=>{const e=t.data.data;await h["a"].insert({data:e}),this.post=h["a"].query().withAll().find(e.id),this.isFetching=!1,this.maybeScrollBottom(),window.document.title=e.title+` - ${this.$t("terevenky")}`}))}}},S=k,x=Object(g["a"])(S,o,n,!1,null,null,null);e["default"]=x.exports;I()(x,"components",{QLinearProgress:v["a"]})},"2b16":function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));s("e6cf");var o=s("77fc");class n{constructor(){if(n.instance)return n.instance;this.api=new o["a"],n.instance=this}async fetchPostComments(t){try{return await this.api.get(`posts/${t}/comments`,null,"comments")}catch(e){console.error(e)}}create(t){return new Promise(((e,s)=>{this.api.post("comments",t,null,"comments").then((t=>e(t))).catch((t=>s(t)))}))}update(t,e){return new Promise(((s,o)=>{this.api.post(`content/comments/${t}`,{body:e},null,"comments").then((t=>s(t))).catch((t=>o(t)))}))}}},"67f1":function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"comment"},[s("div",{staticStyle:{"padding-left":"5px",color:"#5e5e5e"},attrs:{id:"comment-"+t.comment.id}},[s("div",{staticClass:"flex items-center q-pl-sm"},[s("rating",{attrs:{ratingable:t.comment,"ratingable-type":"comment"}}),s("author",{attrs:{name:t.comment.user.login,"is-post-author":t.comment.user.id===t.postAuthor.id,avatar:t.comment.user.avatar?"/storage/user-avatars/r/"+t.comment.user.avatar:null,user:t.comment.user}})],1),s("div",{staticStyle:{margin:"10px 0 20px 10px"}},[t._v("\n      "+t._s(t.comment.body)+"\n    ")]),s("add-comment",{attrs:{"is-reply":"","commentable-id":t.comment.id,"commentable-type":"comment","post-id":t.postId}})],1),t.answers.length?s("div",{staticStyle:{"margin-left":"10px"},style:{borderLeft:t.levelBorderColor}},t._l(t.answers,(function(e,o){return s("comment",{key:e.id,attrs:{comment:e,level:t.level+1,"is-last":t.answers.length-1===o&&!t.isLast,"post-author":t.postAuthor,"post-id":t.postId}})})),1):t._e()])},n=[],i=(s("e6cf"),s("ddb0"),s("72cd")),a=s("d171"),r=s("5fb2c"),c=s("f542"),m={name:"Comment",props:{postId:{type:Number,required:!0},comment:{type:Object,required:!0},level:{type:Number,required:!0},isLast:{type:Boolean,required:!0},postAuthor:{type:Object,required:!0}},components:{AddComment:c["a"],Author:r["a"],Rating:a["a"],Comment:()=>Promise.resolve().then(s.bind(null,"67f1"))},computed:{levelBorderColor(){const t=["#0d47a1","#1565c0","#1976d2","#1e88e5","#2196f3","#42a5f5","#64b5f6","#90caf9","#bbdefb","#e3f2fd"];return"1px solid "+t[(this.level+2)%10]},answers(){return i["a"].query().where((t=>"comments"===t.commentable_type_name&&t.commentable_id===this.comment.id)).orderBy("id","desc").with("rating").with("user").get()}},data(){return{}}},l=m,d=s("2877"),u=Object(d["a"])(l,o,n,!1,null,null,null);e["default"]=u.exports},f542:function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{staticClass:"q-mt-lg q-mb-lg",staticStyle:{color:"darkslategray"},attrs:{flat:""}},[t.isReply&&!t.isExpanded?s("q-card-actions",{staticClass:"q-ml-sm",on:{click:function(e){t.isOpened=!0}}},[s("q-btn",{attrs:{dense:"","no-caps":"",color:"light-green-8"}},[t._v(t._s(t.$t("to_reply")))])],1):t._e(),t.isExpanded?[s("q-card-section",[s("div",[t._v(t._s(t.isReply?t.$t("to_reply"):t.$t("add_comment")))]),s("q-input",{ref:"input",attrs:{autogrow:"",outlined:"",autofocus:t.isReply,error:!!t.validator.errors.body,"error-message":t.validator.errors.body},on:{focus:t.checkAuth,input:function(e){return t.validator.resetErrors()},blur:t.onInputBlur},model:{value:t.formModel.body,callback:function(e){t.$set(t.formModel,"body",e)},expression:"formModel.body"}})],1),t.me&&1===t.me.id?s("select-fake-user",{model:{value:t.fakeUserId,callback:function(e){t.fakeUserId=e},expression:"fakeUserId"}}):t._e(),s("q-separator"),t.showUnauthMessage?s("q-card-section",[s("p",[s("strong",{staticStyle:{color:"red"}},[t._v(t._s(t.$t("need_to_login_or_register")))])]),s("q-btn",{attrs:{dense:"","no-caps":"",to:{name:"login"},label:"Увійти"}}),s("q-btn",{staticClass:"q-ml-sm",attrs:{dense:"","no-caps":"",to:{name:"register"},label:"Зареєструватись"}})],1):t._e(),s("q-card-actions",{staticClass:"q-ml-sm"},[s("q-btn",{attrs:{loading:t.isSubmitting,disable:t.isSubmitting,dense:"","no-caps":"",color:"light-green-8"},on:{click:t.submit}},[t._v("\n        "+t._s(t.$t("submit"))+"\n      ")])],1)]:t._e()],2)},n=[],i=s("891a"),a=s("2b16"),r=s("2ef0"),c=s.n(r),m=s("6357"),l=s("72cd"),d=s("09ad"),u=s("4e60");const h={body:null};var p={name:"AddComment",components:{SelectFakeUser:u["a"]},props:{isReply:{type:Boolean,default:!1},commentableId:{type:Number,required:!0},commentableType:{type:String,required:!0},postId:{type:Number,required:!0}},data(){return{fakeUserId:null,formModel:c.a.cloneDeep(h),isOpened:!1,isSubmitting:!1,api:new a["a"],validator:new m["a"](h),scroll:new d["a"],showUnauthMessage:!1}},computed:{isExpanded(){return!this.isReply||this.isOpened},me(){return i["a"].query().first()}},methods:{onInputBlur(){setTimeout((()=>{this.showUnauthMessage=!1}),500)},checkAuth(){let t=!0;return this.me?this.me.is_verified||(this.$refs.input.blur(),this.$root.$emit("verify-email"),t=!1):(this.showUnauthMessage=!0,t=!1),t},submit(){if(!this.checkAuth())return;this.isSubmitting=!0;const t={post_id:this.postId,commentable_id:this.commentableId,commentable_type:this.commentableType,body:this.formModel.body};1===this.me.id&&this.fakeUserId&&(t.fake_user_id=this.fakeUserId),this.api.create(t).then((t=>{this.formModel=c.a.cloneDeep(h),l["a"].insert({data:t.data}),this.$q.notify({message:this.$t("success"),position:"center",color:"positive"}),this.isSubmitting=!1,this.isReply&&(this.isOpened=!1),setTimeout((()=>{const e=document.getElementById("comment-"+t.data.id);e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),this.scroll.whenScrollFinished().then((()=>{this.flashComment(t.data.id)}))}),10)})).catch((t=>{this.validator.setErrors(t),this.isSubmitting=!1}))},flashComment(t){const e=document.getElementById("comment-"+t),s=e.getBoundingClientRect(),o=s.top<window.innerHeight&&s.bottom>=0;o&&(e.classList.add("flash"),setTimeout((()=>{e.classList.remove("flash")}),2e3))}}},f=p,b=s("2877"),y=s("f09f"),g=s("4b7e"),w=s("9c40"),_=s("a370"),v=s("27f9"),q=s("eb85"),I=s("eebe"),C=s.n(I),$=Object(b["a"])(f,o,n,!1,null,null,null);e["a"]=$.exports;C()($,"components",{QCard:y["a"],QCardActions:g["a"],QBtn:w["a"],QCardSection:_["a"],QInput:v["a"],QSeparator:q["a"]})}}]);